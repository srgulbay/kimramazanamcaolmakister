<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YaÅŸa Ã–zel Ä°slami Bilgi YarÄ±ÅŸmasÄ± (Revize EdilmiÅŸ)</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap');
        :root {
            --primary-bg: linear-gradient(135deg, #72EDF2, #5151E5);
            --container-bg: rgba(255, 255, 255, 0.98);
            --question-bg: #e8eaf6;
            --scoreboard-bg: #eceff1;
            --primary-text: #333;
            --header-color: #3f51b5;
            --subheader-color: #5e35b1;
            --winner-color: #ff6f00;
            --theme-child-bg: #e0f7fa; --theme-child-border: #4dd0e1; --theme-child-header: #0097a7; --theme-child-button: linear-gradient(145deg, #26c6da, #00acc1); --theme-child-button-hover: linear-gradient(145deg, #00acc1, #26c6da);
            --theme-teen-bg: #e8f5e9; --theme-teen-border: #81c784; --theme-teen-header: #388e3c; --theme-teen-button: linear-gradient(145deg, #66bb6a, #43a047); --theme-teen-button-hover: linear-gradient(145deg, #43a047, #66bb6a);
            --theme-young-adult-bg: #f3e5f5; --theme-young-adult-border: #ce93d8; --theme-young-adult-header: #8e24aa; --theme-young-adult-button: linear-gradient(145deg, #ab47bc, #8e24aa); --theme-young-adult-button-hover: linear-gradient(145deg, #8e24aa, #ab47bc);
            --correct-color: #2e7d32; --incorrect-color: #c62828;
        }
        body { font-family: 'Poppins', sans-serif; display: flex; justify-content: center; align-items: flex-start; min-height: 100vh; background: var(--primary-bg); color: var(--primary-text); padding: 10px; box-sizing: border-box; }
        #quiz-container { background-color: var(--container-bg); padding: 20px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15); text-align: center; width: 100%; max-width: 1200px; }
        h1, h2 { color: var(--header-color); margin-bottom: 20px; } h2 { color: var(--subheader-color); font-size: 1.5em; } h3 { color: var(--subheader-color); font-size: 1.2em; margin-bottom: 10px; }
        #name-entry { padding: 20px; border: 1px solid #ddd; border-radius: 10px; margin-bottom: 20px; background-color: #fafafa; display: flex; flex-wrap: wrap; justify-content: space-around; gap: 15px; }
        .player-input-group { flex: 1 1 250px; text-align: left; background: #fff; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);}
        .player-input-group label { display: block; margin-bottom: 5px; font-weight: 600; color: var(--subheader-color); }
        .player-input-group input { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 5px; font-size: 1em; box-sizing: border-box; margin-bottom: 5px; }
        #confirm-container { width: 100%; text-align: center; margin-top: 15px; }
        #quiz-content { display: none; }
        #narration-area { margin-bottom: 20px; padding: 15px; background-color: var(--question-bg); border-radius: 10px; text-align: center; }
        #narration-area p { font-style: italic; color: #555; margin-bottom: 15px; }
        #play-narration-btn { padding: 10px 20px; font-size: 1em; cursor: pointer; background: var(--start-button-gradient); color: white; border: none; border-radius: 8px; transition: background-color 0.3s; }
        #play-narration-btn:disabled { background-color: #aaa; cursor: not-allowed; }
        #scoreboard { background-color: var(--scoreboard-bg); padding: 10px 15px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        #scoreboard h3 { margin: 0 0 10px 0; color: var(--subheader-color); font-size: 1.1em; }
        #scoreboard-list { list-style: none; padding: 0; margin: 0; display: flex; justify-content: space-around; text-align: center; flex-wrap: wrap;}
        #scoreboard-list li { font-size: 1em; padding: 5px 10px; }
        #scoreboard-list .name { font-weight: 600; }
        #scoreboard-list .score { font-weight: bold; margin-left: 5px; }
        #players-area { display: flex; justify-content: space-between; flex-wrap: wrap; gap: 15px; }
        .player-quiz-area { flex: 1 1 30%; min-width: 280px; border-radius: 12px; padding: 15px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1); border-top: 5px solid; transition: border-color 0.5s ease, opacity 0.5s ease; text-align: center; opacity: 0; }
        .player-quiz-area.visible { opacity: 1; }
        .theme-child { background-color: var(--theme-child-bg); border-color: var(--theme-child-border); }
        .theme-teen { background-color: var(--theme-teen-bg); border-color: var(--theme-teen-border); }
        .theme-young-adult { background-color: var(--theme-young-adult-bg); border-color: var(--theme-young-adult-border); }
        .player-info { margin-bottom: 15px; font-weight: 600; font-size: 1.1em; }
        .player-info .player-age { font-size: 0.9em; color: #555; margin-left: 5px; }
        .theme-child .player-info { color: var(--theme-child-header); }
        .theme-teen .player-info { color: var(--theme-teen-header); }
        .theme-young-adult .player-info { color: var(--theme-young-adult-header); }
        .player-question { min-height: 70px; margin-bottom: 15px; padding: 10px; background-color: rgba(255,255,255, 0.7); border-radius: 8px; display: flex; justify-content: center; align-items: center; font-size: 1.05em; font-weight: 600; line-height: 1.4; }
        .player-options button { display: block; width: 100%; padding: 9px; margin: 6px 0; border: none; border-radius: 8px; color: white; cursor: pointer; font-size: 0.95em; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 2px 4px rgba(0,0,0,0.15); }
        .theme-child .player-options button { background: var(--theme-child-button); }
        .theme-child .player-options button:hover:not(:disabled) { background: var(--theme-child-button-hover); }
        .theme-teen .player-options button { background: var(--theme-teen-button); }
        .theme-teen .player-options button:hover:not(:disabled) { background: var(--theme-teen-button-hover); }
        .theme-young-adult .player-options button { background: var(--theme-young-adult-button); }
        .theme-young-adult .player-options button:hover:not(:disabled) { background: var(--theme-young-adult-button-hover); }
        .player-options button:disabled { background: #cccccc !important; cursor: not-allowed; opacity: 0.7; transform: none; box-shadow: none; }
        .player-feedback { min-height: 20px; margin-top: 10px; font-weight: 600; font-size: 0.9em; }
        .feedback-correct { color: var(--correct-color); }
        .feedback-incorrect { color: var(--incorrect-color); }
        #results { display: none; margin-top: 30px; }
        #final-scores { margin-bottom: 20px;}
        .result-line { font-size: 1.2em; margin: 10px 0; padding: 8px; border-radius: 5px; background-color: #f0f0f0; display: flex; justify-content: space-between; }
        .result-line .name { font-weight: 600; flex-grow: 1; text-align: left; margin-right: 10px; }
        .result-line .score { font-weight: bold; }
        #winner-info { font-size: 1.4em; font-weight: bold; color: var(--winner-color); margin-top: 15px; }
        #confirm-names-button, #restart-button { padding: 12px 25px; font-size: 1.2em; font-weight: 600; cursor: pointer; margin-top: 20px; background: var(--start-button-gradient); color: white; border: none; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.15); transition: all 0.3s ease; }
        #confirm-names-button:hover, #restart-button:hover { background: var(--start-button-hover-gradient); box-shadow: 0 6px 12px rgba(0,0,0,0.2); transform: translateY(-2px); }
        #loading-indicator { display: none; font-size: 1.2em; color: var(--subheader-color); margin: 20px; font-weight: bold; }
    </style>
</head>
<body>
    <div id="quiz-container">
        <h1>YaÅŸa Ã–zel Ä°slami Bilgi YarÄ±ÅŸmasÄ± (Revize EdilmiÅŸ)</h1>

        <div id="name-entry">
            <div class="player-input-group">
                <label for="player-1-name-input">Oyuncu 1 AdÄ±:</label>
                <input type="text" id="player-1-name-input" placeholder="Ä°sim..." maxlength="20">
                <label for="player-1-age-input">YaÅŸÄ± (7-18):</label>
                <input type="number" id="player-1-age-input" min="7" max="18" placeholder="YaÅŸ...">
            </div>
            <div class="player-input-group">
                <label for="player-2-name-input">Oyuncu 2 AdÄ±:</label>
                <input type="text" id="player-2-name-input" placeholder="Ä°sim..." maxlength="20">
                <label for="player-2-age-input">YaÅŸÄ± (7-18):</label>
                <input type="number" id="player-2-age-input" min="7" max="18" placeholder="YaÅŸ...">
            </div>
            <div class="player-input-group">
                <label for="player-3-name-input">Oyuncu 3 AdÄ±:</label>
                <input type="text" id="player-3-name-input" placeholder="Ä°sim..." maxlength="20">
                <label for="player-3-age-input">YaÅŸÄ± (7-18):</label>
                <input type="number" id="player-3-age-input" min="7" max="18" placeholder="YaÅŸ...">
            </div>
            <div id="confirm-container">
                <button id="confirm-names-button">YarÄ±ÅŸmayÄ± BaÅŸlat</button>
            </div>
            <p id="tts-support-warning" style="color: red; width: 100%; text-align: center; margin-top: 10px; display: none;">TarayÄ±cÄ±nÄ±z metin seslendirme Ã¶zelliÄŸini desteklemiyor olabilir.</p>
        </div>

        <div id="quiz-content">
            <div id="narration-area" style="display: none;">
                <p id="narration-info">Åimdi dikkatle dinleyin...</p>
                <button id="play-narration-btn">AnlatÄ±mÄ± Seslendir</button>
            </div>
            <div id="loading-indicator">SÄ±radaki sorular hazÄ±rlanÄ±yor...</div>
            <div id="scoreboard" style="display: none;">
                 <h3>Skor Tablosu</h3>
                 <ul id="scoreboard-list"></ul>
            </div>
            <div id="players-area">
                 <div class="player-quiz-area" id="player-area-1">
                    <div class="player-info">
                        <span class="player-name" id="player-1-name-display">Oyuncu 1</span>
                        <span class="player-age" id="player-1-age-display">(YaÅŸ)</span>
                    </div>
                    <div class="player-question" id="question-player-1">Soru yÃ¼kleniyor...</div>
                    <div class="player-options" id="options-player-1"></div>
                    <div class="player-feedback" id="feedback-player-1"></div>
                 </div>
                 <div class="player-quiz-area" id="player-area-2">
                    <div class="player-info">
                        <span class="player-name" id="player-2-name-display">Oyuncu 2</span>
                        <span class="player-age" id="player-2-age-display">(YaÅŸ)</span>
                     </div>
                    <div class="player-question" id="question-player-2">Soru yÃ¼kleniyor...</div>
                    <div class="player-options" id="options-player-2"></div>
                    <div class="player-feedback" id="feedback-player-2"></div>
                 </div>
                 <div class="player-quiz-area" id="player-area-3">
                     <div class="player-info">
                        <span class="player-name" id="player-3-name-display">Oyuncu 3</span>
                        <span class="player-age" id="player-3-age-display">(YaÅŸ)</span>
                    </div>
                    <div class="player-question" id="question-player-3">Soru yÃ¼kleniyor...</div>
                    <div class="player-options" id="options-player-3"></div>
                    <div class="player-feedback" id="feedback-player-3"></div>
                 </div>
            </div>
        </div>

        <div id="results">
             <h2>YarÄ±ÅŸma Bitti!</h2>
             <div id="final-scores"></div>
             <p id="winner-info"></p>
             <button id="restart-button">Yeni Oyun (Yeni Ä°simlerle)</button>
        </div>
    </div>

    <script>
        // *** TÃœM JAVASCRIPT KODU BURADA ***
        document.addEventListener('DOMContentLoaded', () => {

            // --- SORU HAVUZU (GeniÅŸletilmiÅŸ Ã–rnek) ---
            const questionPool = [
                // Segment 1 (Fatiha 1-4) SorularÄ±
                { questionId: 101, segmentId: 1, questionText: "Metin hangi kelime ile baÅŸlar?", options: ["Hamd", "Rahman", "Allah", "Rab"], correctAnswer: "Allah", minAge: 7, maxAge: 10 },
                { questionId: 102, segmentId: 1, questionText: "'Hamd' ne demek?", options: ["Sevgi", "Ã–vgÃ¼/ÅÃ¼kÃ¼r", "GÃ¼Ã§", "GÃ¼n"], correctAnswer: "Ã–vgÃ¼/ÅÃ¼kÃ¼r", minAge: 7, maxAge: 10 },
                { questionId: 103, segmentId: 1, questionText: "Metinde geÃ§en Allah'Ä±n gÃ¼zel isimlerinden biri hangisidir?", options: ["Kadir", "Rahim", "Alim", "Semi"], correctAnswer: "Rahim", minAge: 7, maxAge: 10 },
                { questionId: 104, segmentId: 1, questionText: "Allah neyin sahibidir?", options: ["Sadece iyilerin", "Sadece dÃ¼nyanÄ±n", "Hesap gÃ¼nÃ¼nÃ¼n", "Sadece MÃ¼slÃ¼manlarÄ±n"], correctAnswer: "Hesap gÃ¼nÃ¼nÃ¼n", minAge: 8, maxAge: 11 },
                { questionId: 105, segmentId: 1, questionText: "Metinde hangi kelime iki kere geÃ§er?", options: ["Allah", "Rab", "Rahman/Rahim", "Hamd"], correctAnswer: "Rahman/Rahim", minAge: 9, maxAge: 12 },
                { questionId: 106, segmentId: 1, questionText: "'Alemlerin Rabbi' ifadesi Allah'Ä±n hangi Ã¶zelliÄŸini daha Ã§ok vurgular?", options: ["AffediciliÄŸini", "CÃ¶mertliÄŸini", "TÃ¼m varlÄ±klarÄ±n sahibi ve yÃ¶neticisi olduÄŸunu", "CezalandÄ±rÄ±cÄ± olduÄŸunu"], correctAnswer: "TÃ¼m varlÄ±klarÄ±n sahibi ve yÃ¶neticisi olduÄŸunu", minAge: 11, maxAge: 14 },
                { questionId: 107, segmentId: 1, questionText: "Rahman ve Rahim isimleri Allah'Ä±n hangi yÃ¶nÃ¼nÃ¼ Ã¶ne Ã§Ä±karÄ±r?", options: ["GÃ¼cÃ¼nÃ¼", "Adaletini", "Merhametini", "Bilgisini"], correctAnswer: "Merhametini", minAge: 11, maxAge: 14 },
                { questionId: 108, segmentId: 1, questionText: "'Hesap gÃ¼nÃ¼' ifadesinden ne anlÄ±yoruz?", options: ["DÃ¼nyanÄ±n sonu", "Ä°nsanlarÄ±n yaptÄ±klarÄ±ndan sorgulanacaÄŸÄ± gÃ¼n", "Cennete giriÅŸ gÃ¼nÃ¼", "Bayram gÃ¼nÃ¼"], correctAnswer: "Ä°nsanlarÄ±n yaptÄ±klarÄ±ndan sorgulanacaÄŸÄ± gÃ¼n", minAge: 11, maxAge: 15 },
                { questionId: 109, segmentId: 1, questionText: "Metne gÃ¶re 'Hamd' kime 'mahsustur'?", options: ["Peygambere", "Meleklere", "Ä°nsanlara", "Allah'a"], correctAnswer: "Allah'a", minAge: 10, maxAge: 14 },
                { questionId: 110, segmentId: 1, questionText: "Fatiha suresinin bu ayetlerinde Allah'Ä±n hangi isim/sÄ±fatÄ± GEÃ‡MEZ?", options: ["Rab", "Rahman", "Melik", "Rahim"], correctAnswer: "Melik", minAge: 12, maxAge: 16 },
                { questionId: 111, segmentId: 1, questionText: "'Rab' kelimesinin kÃ¶k anlamlarÄ±ndan biri hangisi DEÄÄ°LDÄ°R?", options: ["Terbiye eden", "Sahip olan", "YÃ¶neten", "Uzak olan"], correctAnswer: "Uzak olan", minAge: 15, maxAge: 18 },
                { questionId: 112, segmentId: 1, questionText: "'Din GÃ¼nÃ¼' (Hesap GÃ¼nÃ¼) kavramÄ± hangi temel inanÃ§la doÄŸrudan ilgilidir?", options: ["Kadere iman", "Ahirete iman", "Kitaplara iman", "Meleklere iman"], correctAnswer: "Ahirete iman", minAge: 15, maxAge: 18 },
                { questionId: 113, segmentId: 1, questionText: "Rahman ve Rahim sÄ±fatlarÄ±nÄ±n birlikte zikredilmesi neyi ifade eder?", options: ["Allah'Ä±n sadece MÃ¼slÃ¼manlara merhamet ettiÄŸini", "Allah'Ä±n merhametinin hem dÃ¼nyada hem ahirette geniÅŸ olduÄŸunu", "Allah'Ä±n cezalandÄ±rmayacaÄŸÄ±nÄ±", "Merhametin sadece insanlara Ã¶zgÃ¼ olduÄŸunu"], correctAnswer: "Allah'Ä±n merhametinin hem dÃ¼nyada hem ahirette geniÅŸ olduÄŸunu", minAge: 14, maxAge: 18 },
                { questionId: 114, segmentId: 1, questionText: "Bu ayetlerde hangi dua veya talep ifadesi yer alÄ±r?", options: ["Bizi doÄŸru yola ilet", "Bize yardÄ±m et", "Bizi affet", "HiÃ§biri"], correctAnswer: "HiÃ§biri", minAge: 13, maxAge: 18 },
                { questionId: 115, segmentId: 1, questionText: "Fatiha suresinin bu ilk ayetleri genel olarak neyi konu alÄ±r?", options: ["Ahlak kurallarÄ±", "Peygamber kÄ±ssalarÄ±", "Allah'a hamd ve O'nun temel sÄ±fatlarÄ±", "Ä°badetlerin yapÄ±lÄ±ÅŸÄ±"], correctAnswer: "Allah'a hamd ve O'nun temel sÄ±fatlarÄ±", minAge: 12, maxAge: 18 },

                // --- Segment 2 (Niyet Hadisi) ---
                { questionId: 201, segmentId: 2, questionText: "YaptÄ±ÄŸÄ±mÄ±z bir iÅŸin iyi mi kÃ¶tÃ¼ mÃ¼ olduÄŸunu belirleyen en Ã¶nemli ÅŸey nedir?", options: ["Ä°ÅŸin bÃ¼yÃ¼klÃ¼ÄŸÃ¼", "Niyetimiz", "Kimsenin gÃ¶rmemesi", "HÄ±zlÄ± yapmak"], correctAnswer: "Niyetimiz", minAge: 7, maxAge: 10 },
                { questionId: 202, segmentId: 2, questionText: "Hadiste adÄ± geÃ§en Peygamberimiz kimdir?", options: ["Hz. Ä°sa", "Hz. Musa", "Hz. Muhammed (sav)", "Hz. Adem"], correctAnswer: "Hz. Muhammed (sav)", minAge: 7, maxAge: 10 },
                { questionId: 203, segmentId: 2, questionText: "Bir kiÅŸi Allah iÃ§in bir iÅŸ yaparsa, karÅŸÄ±lÄ±ÄŸÄ±nÄ± kimden alÄ±r?", options: ["Ä°nsanlardan", "Patronundan", "Allah'tan", "Kimseden"], correctAnswer: "Allah'tan", minAge: 8, maxAge: 11 },
                { questionId: 204, segmentId: 2, questionText: "Metinde geÃ§en 'amel' ne demektir?", options: ["Niyet", "Ä°ÅŸ, davranÄ±ÅŸ", "Para", "Ev"], correctAnswer: "Ä°ÅŸ, davranÄ±ÅŸ", minAge: 9, maxAge: 12 },
                { questionId: 205, segmentId: 2, questionText: "Ä°nsan ne niyet ederse, genellikle neyi elde eder?", options: ["HiÃ§bir ÅŸeyi", "Niyet ettiÄŸini", "Niyet etmediÄŸini", "BaÅŸkasÄ±nÄ±n niyet ettiÄŸini"], correctAnswer: "Niyet ettiÄŸini", minAge: 7, maxAge: 10 },
                { questionId: 206, segmentId: 2, questionText: "Hadise gÃ¶re, sadece evlenmek amacÄ±yla yapÄ±lan bir hicretin (iÅŸin) deÄŸeri nedir?", options: ["Allah katÄ±nda Ã§ok deÄŸerlidir", "Hem Allah hem insanlar katÄ±nda deÄŸerlidir", "Sadece o evlilikle sÄ±nÄ±rlÄ±dÄ±r", "HiÃ§bir deÄŸeri yoktur"], correctAnswer: "Sadece o evlilikle sÄ±nÄ±rlÄ±dÄ±r", minAge: 11, maxAge: 14 },
                { questionId: 207, segmentId: 2, questionText: "'Hicret' kelimesi bu hadiste sadece fiziksel gÃ¶Ã§Ã¼ mÃ¼ ifade eder?", options: ["Evet, sadece onu", "HayÄ±r, manevi yÃ¶neliÅŸi de kapsar", "Sadece savaÅŸa gitmeyi", "Sadece ticareti"], correctAnswer: "HayÄ±r, manevi yÃ¶neliÅŸi de kapsar", minAge: 11, maxAge: 15 },
                { questionId: 208, segmentId: 2, questionText: "Bu hadis, ibadetlerimizde ve gÃ¼nlÃ¼k iÅŸlerimizde neye dikkat etmemizi vurgular?", options: ["Ä°ÅŸin sonucuna", "Ä°ÅŸi yapan kiÅŸiye", "Ä°ÅŸin yapÄ±lÄ±ÅŸ niyetine", "Ä°ÅŸin sÃ¼resine"], correctAnswer: "Ä°ÅŸin yapÄ±lÄ±ÅŸ niyetine", minAge: 10, maxAge: 14 },
                { questionId: 209, segmentId: 2, questionText: "Hadiste 'Resul' kelimesi kim iÃ§in kullanÄ±lÄ±r?", options: ["ElÃ§i, Peygamber", "YÃ¶netici", "TÃ¼ccar", "Ã–ÄŸretmen"], correctAnswer: "ElÃ§i, Peygamber", minAge: 11, maxAge: 14 },
                { questionId: 210, segmentId: 2, questionText: "Niyetin Ã¶nemini anlatan bu hadis hangi Ã¼nlÃ¼ hadis kitabÄ±nda yer alÄ±r?", options: ["RiyazÃ¼s Salihin", "Muvatta", "Buhari ve MÃ¼slim", "Tirmizi"], correctAnswer: "Buhari ve MÃ¼slim", minAge: 13, maxAge: 16 },
                { questionId: 211, segmentId: 2, questionText: "Bu hadis Ä°slam hukukunda (fÄ±kÄ±h) hangi prensibin temelini oluÅŸturur?", options: ["Zaruretler haramÄ± mÃ¼bah kÄ±lar", "Niyet amelin ruhudur", "KolaylaÅŸtÄ±rÄ±nÄ±z, zorlaÅŸtÄ±rmayÄ±nÄ±z", "ÅÃ¼phe ile yakin zail olmaz"], correctAnswer: "Niyet amelin ruhudur", minAge: 15, maxAge: 18 },
                { questionId: 212, segmentId: 2, questionText: "Hadiste geÃ§en 'dÃ¼nyalÄ±k' ifadesi neleri kapsayabilir?", options: ["Sadece para", "Sadece mal mÃ¼lk", "Makam, ÅŸÃ¶hret, kazanÃ§ gibi geÃ§ici ÅŸeyler", "Sadece aile"], correctAnswer: "Makam, ÅŸÃ¶hret, kazanÃ§ gibi geÃ§ici ÅŸeyler", minAge: 14, maxAge: 18 },
                { questionId: 213, segmentId: 2, questionText: "Niyetin gizli olmasÄ± mÄ±, aÃ§Ä±k olmasÄ± mÄ± amelin deÄŸerini etkiler?", options: ["Gizli olmasÄ±", "AÃ§Ä±k olmasÄ±", "Hadiste buna deÄŸinilmiyor", "Niyetin kendisi Ã¶nemlidir, gizliliÄŸi/aÃ§Ä±klÄ±ÄŸÄ± deÄŸil"], correctAnswer: "Niyetin kendisi Ã¶nemlidir, gizliliÄŸi/aÃ§Ä±klÄ±ÄŸÄ± deÄŸil", minAge: 15, maxAge: 18 },
                { questionId: 214, segmentId: 2, questionText: "Bir amelin hem Allah rÄ±zasÄ± hem de dÃ¼nyalÄ±k bir beklentiyle yapÄ±lmasÄ± durumunda hadise gÃ¶re sonuÃ§ ne olabilir?", options: ["Kesinlikle kabul olmaz", "Sadece Allah rÄ±zasÄ± geÃ§erli olur", "Niyetin hangisinin aÄŸÄ±r bastÄ±ÄŸÄ±na gÃ¶re deÄŸiÅŸir", "Sadece dÃ¼nyalÄ±k elde edilir"], correctAnswer: "Niyetin hangisinin aÄŸÄ±r bastÄ±ÄŸÄ±na gÃ¶re deÄŸiÅŸir", minAge: 16, maxAge: 18 },
                { questionId: 215, segmentId: 2, questionText: "Bu hadisten Ã§Ä±karÄ±lacak en temel ders nedir?", options: ["GÃ¶Ã§ etmek sevaptÄ±r", "Evlenmek Ã¶nemlidir", "Her iÅŸte Allah rÄ±zasÄ±nÄ± gÃ¶zetmek gerekir", "Ã‡ok amel iÅŸlemek gerekir"], correctAnswer: "Her iÅŸte Allah rÄ±zasÄ±nÄ± gÃ¶zetmek gerekir", minAge: 12, maxAge: 18 },

                 // --- Segment 3 (Ä°hlas Suresi) ---
                 { questionId: 301, segmentId: 3, questionText: "Ä°hlas suresine gÃ¶re Allah kaÃ§tÄ±r?", options: ["Ä°ki", "ÃœÃ§", "SayÄ±sÄ±z", "Bir"], correctAnswer: "Bir", minAge: 7, maxAge: 9 },
                 { questionId: 302, segmentId: 3, questionText: "Her ÅŸey kime muhtaÃ§tÄ±r?", options: ["Peygambere", "Ä°nsanlara", "Meleklere", "Allah'a"], correctAnswer: "Allah'a", minAge: 7, maxAge: 10 },
                 { questionId: 303, segmentId: 3, questionText: "Allah'Ä±n Ã§ocuÄŸu veya anne-babasÄ± var mÄ±dÄ±r?", options: ["VardÄ±r", "Yoktur", "Sadece Ã§ocuÄŸu vardÄ±r", "Sadece annesi vardÄ±r"], correctAnswer: "Yoktur", minAge: 7, maxAge: 10 },
                 { questionId: 304, segmentId: 3, questionText: "Allah'a benzeyen baÅŸka bir ÅŸey var mÄ±dÄ±r?", options: ["Evet, melekler", "Evet, insanlar", "HayÄ±r, O'na denk hiÃ§bir ÅŸey yoktur", "Evet, gÃ¼neÅŸ"], correctAnswer: "HayÄ±r, O'na denk hiÃ§bir ÅŸey yoktur", minAge: 8, maxAge: 11 },
                 { questionId: 305, segmentId: 3, questionText: "Surenin adÄ± nedir?", options: ["Fatiha", "Nas", "Felak", "Ä°hlas"], correctAnswer: "Ä°hlas", minAge: 9, maxAge: 12 },
                 { questionId: 306, segmentId: 3, questionText: "'Samed' sÄ±fatÄ± Allah'Ä±n hangi Ã¶zelliÄŸini ifade eder?", options: ["AffediciliÄŸini", "YaratÄ±cÄ±lÄ±ÄŸÄ±nÄ±", "HiÃ§bir ÅŸeye muhtaÃ§ olmayÄ±p her ÅŸeyin O'na muhtaÃ§ olduÄŸunu", "Adaletini"], correctAnswer: "HiÃ§bir ÅŸeye muhtaÃ§ olmayÄ±p her ÅŸeyin O'na muhtaÃ§ olduÄŸunu", minAge: 11, maxAge: 14 },
                 { questionId: 307, segmentId: 3, questionText: "Ä°hlas suresi Ä°slam'Ä±n hangi temel ilkesini Ã¶zetler?", options: ["Namaz", "Zekat", "Tevhid (Allah'Ä±n birliÄŸi)", "Ahiret"], correctAnswer: "Tevhid (Allah'Ä±n birliÄŸi)", minAge: 11, maxAge: 15 },
                 { questionId: 308, segmentId: 3, questionText: "'Lem yelid ve lem yÃ»led' ayetinin anlamÄ± nedir?", options: ["O gÃ¶rÃ¼r ve iÅŸitir", "O doÄŸurmamÄ±ÅŸ ve doÄŸmamÄ±ÅŸtÄ±r", "O baÄŸÄ±ÅŸlar ve merhamet eder", "O diriltir ve Ã¶ldÃ¼rÃ¼r"], correctAnswer: "O doÄŸurmamÄ±ÅŸ ve doÄŸmamÄ±ÅŸtÄ±r", minAge: 10, maxAge: 14 },
                 { questionId: 309, segmentId: 3, questionText: "Bu sureye neden 'Ä°hlas' denmiÅŸ olabilir?", options: ["OkumasÄ± Ã§ok kolay olduÄŸu iÃ§in", "Ã‡ok kÄ±sa olduÄŸu iÃ§in", "Allah'a katÄ±ÅŸÄ±ksÄ±z, samimi inancÄ± ifade ettiÄŸi iÃ§in", "Sadece namazda okunduÄŸu iÃ§in"], correctAnswer: "Allah'a katÄ±ÅŸÄ±ksÄ±z, samimi inancÄ± ifade ettiÄŸi iÃ§in", minAge: 12, maxAge: 16 },
                 { questionId: 310, segmentId: 3, questionText: "Surede Allah iÃ§in hangi ifade kullanÄ±lmaz?", options: ["Bir", "Samed", "Denk", "Rahman"], correctAnswer: "Rahman", minAge: 11, maxAge: 15 },
                 { questionId: 311, segmentId: 3, questionText: "Ä°hlas suresi, hangi yanlÄ±ÅŸ inanÃ§lara doÄŸrudan bir cevap niteliÄŸindedir?", options: ["Meleklere inanmamaya", "Kadere inanmamaya", "Allah'a ortak koÅŸmaya (ÅŸirk) ve O'na Ã§ocuk isnat etmeye", "Ahireti inkar etmeye"], correctAnswer: "Allah'a ortak koÅŸmaya (ÅŸirk) ve O'na Ã§ocuk isnat etmeye", minAge: 15, maxAge: 18 },
                 { questionId: 312, segmentId: 3, questionText: "'Samed' isminin tecellisi olarak evrendeki dÃ¼zen neyi gÃ¶sterir?", options: ["Her ÅŸeyin tesadÃ¼fen olduÄŸunu", "Evrenin kendi kendine yettiÄŸini", "Her ÅŸeyin bir yaratÄ±cÄ±ya ve dÃ¼zenleyiciye muhtaÃ§ olduÄŸunu", "Evrenin sonsuz olduÄŸunu"], correctAnswer: "Her ÅŸeyin bir yaratÄ±cÄ±ya ve dÃ¼zenleyiciye muhtaÃ§ olduÄŸunu", minAge: 15, maxAge: 18 },
                 { questionId: 313, segmentId: 3, questionText: "'HiÃ§bir ÅŸey O'na denk deÄŸildir' ayeti Allah'Ä±n hangi sÄ±fatÄ±nÄ± vurgular?", options: ["Hayat", "Ä°lim", "MuhalefetÃ¼n lil havadis (YaratÄ±lmÄ±ÅŸlara benzememek)", "KÄ±yam bi nefsihi (VarlÄ±ÄŸÄ± kendinden olmak)"], correctAnswer: "MuhalefetÃ¼n lil havadis (YaratÄ±lmÄ±ÅŸlara benzememek)", minAge: 16, maxAge: 18 },
                 { questionId: 314, segmentId: 3, questionText: "Bu surenin Kur'an'Ä±n Ã¼Ã§te birine denk olduÄŸu rivayet edilir. Bunun sebebi ne olabilir?", options: ["En Ã§ok okunan sure olmasÄ±", "En kÄ±sa sure olmasÄ±", "Ä°manÄ±n temeli olan Tevhid'i Ã¶zlÃ¼ce anlatmasÄ±", "Ezberlemesi en kolay olmasÄ±"], correctAnswer: "Ä°manÄ±n temeli olan Tevhid'i Ã¶zlÃ¼ce anlatmasÄ±", minAge: 14, maxAge: 18 },
                 { questionId: 315, segmentId: 3, questionText: "Sure hangi kelime ile baÅŸlar?", options: ["Allah", "De ki", "Samed", "Bir"], correctAnswer: "De ki", minAge: 12, maxAge: 18 },

                 // --- Segment 4 (SabÄ±r) ---
                 { questionId: 401, segmentId: 4, questionText: "Zor bir durumla karÅŸÄ±laÅŸÄ±nca ne yapmalÄ±yÄ±z?", options: ["KÄ±zmak", "Sabretmek", "KaÃ§mak", "Uyumak"], correctAnswer: "Sabretmek", minAge: 7, maxAge: 10 },
                 { questionId: 402, segmentId: 4, questionText: "Her zorluÄŸun yanÄ±nda ne gelirmiÅŸ?", options: ["Daha Ã§ok zorluk", "Bir kolaylÄ±k", "Bir hediye", "Bir ceza"], correctAnswer: "Bir kolaylÄ±k", minAge: 7, maxAge: 10 },
                 { questionId: 403, segmentId: 4, questionText: "Sabredenler sonunda ne kazanÄ±r?", options: ["HiÃ§bir ÅŸey", "Oyuncaq", "Allah'tan mÃ¼kafat", "Pasta"], correctAnswer: "Allah'tan mÃ¼kafat", minAge: 8, maxAge: 11 },
                 { questionId: 404, segmentId: 4, questionText: "Metne gÃ¶re sabÄ±r neyin yarÄ±sÄ±ymÄ±ÅŸ?", options: ["ElmanÄ±n", "GÃ¼nÃ¼n", "Ä°manÄ±n", "Oyunun"], correctAnswer: "Ä°manÄ±n", minAge: 7, maxAge: 10 },
                 { questionId: 405, segmentId: 4, questionText: "Zorluk anÄ±nda kimden yardÄ±m istemeliyiz?", options: ["ArkadaÅŸÄ±mÄ±zdan", "Ã–ÄŸretmenden", "Allah'tan", "Kimseden"], correctAnswer: "Allah'tan", minAge: 7, maxAge: 10 },
                 { questionId: 406, segmentId: 4, questionText: "Metinde sabrÄ±n tanÄ±mÄ± iÃ§inde hangisi yoktur?", options: ["YÄ±lgÄ±nlÄ±k gÃ¶stermemek", "Aceleci davranmamak", "Ä°syan etmek", "Allah'tan yardÄ±m dileyerek beklemek"], correctAnswer: "Ä°syan etmek", minAge: 11, maxAge: 14 },
                 { questionId: 407, segmentId: 4, questionText: "'Ä°manÄ±n yarÄ±sÄ±' ifadesi sabrÄ±n ne kadar Ã¶nemli olduÄŸunu gÃ¶sterir?", options: ["Ã‡ok az Ã¶nemli", "Biraz Ã¶nemli", "Ã‡ok Ã¶nemli", "HiÃ§ Ã¶nemli deÄŸil"], correctAnswer: "Ã‡ok Ã¶nemli", minAge: 10, maxAge: 14 },
                 { questionId: 408, segmentId: 4, questionText: "'Her zorlukla beraber bir kolaylÄ±k vardÄ±r' ayeti hangi surede geÃ§er?", options: ["Fatiha", "Ä°hlas", "Ä°nÅŸirah", "Nasr"], correctAnswer: "Ä°nÅŸirah", minAge: 13, maxAge: 16 },
                 { questionId: 409, segmentId: 4, questionText: "Metne gÃ¶re sabretmek pasif bir bekleyiÅŸ midir?", options: ["Evet, sadece beklemektir", "HayÄ±r, Allah'tan yardÄ±m dileyerek aktif bir bekleyiÅŸtir", "Bazen evet, bazen hayÄ±r", "Metinde belirtilmiyor"], correctAnswer: "HayÄ±r, Allah'tan yardÄ±m dileyerek aktif bir bekleyiÅŸtir", minAge: 12, maxAge: 15 },
                 { questionId: 410, segmentId: 4, questionText: "'MÃ¼kafat' kelimesinin anlamÄ± nedir?", options: ["Ceza", "Ã–dÃ¼l, karÅŸÄ±lÄ±k", "Unutmak", "Kaybetmek"], correctAnswer: "Ã–dÃ¼l, karÅŸÄ±lÄ±k", minAge: 11, maxAge: 14 },
                 { questionId: 411, segmentId: 4, questionText: "SabÄ±r kavramÄ±, Ä°slam'daki hangi diÄŸer kavramlarla yakÄ±ndan iliÅŸkilidir?", options: ["Acelecilik ve TelaÅŸ", "TevekkÃ¼l, ÅÃ¼kÃ¼r ve RÄ±za", "Ä°syan ve Ãœmitsizlik", "GÃ¶steriÅŸ ve Kibir"], correctAnswer: "TevekkÃ¼l, ÅÃ¼kÃ¼r ve RÄ±za", minAge: 15, maxAge: 18 },
                 { questionId: 412, segmentId: 4, questionText: "Zorluk anÄ±nda 'yÄ±lgÄ±nlÄ±k gÃ¶stermemek' psikolojik olarak neyi ifade eder?", options: ["Duygusuz olmayÄ±", "UmutsuzluÄŸa kapÄ±lmamayÄ±, direnmeyi", "Sorunu gÃ¶rmezden gelmeyi", "BaÅŸkalarÄ±nÄ± suÃ§lamayÄ±"], correctAnswer: "UmutsuzluÄŸa kapÄ±lmamayÄ±, direnmeyi", minAge: 14, maxAge: 18 },
                 { questionId: 413, segmentId: 4, questionText: "Allah'tan yardÄ±m dileyerek beklemenin ardÄ±ndaki temel inanÃ§ nedir?", options: ["Her ÅŸeyin kendi kendine olacaÄŸÄ±", "Ä°nsanlarÄ±n mutlaka yardÄ±m edeceÄŸi", "Allah'Ä±n her ÅŸeye gÃ¼cÃ¼nÃ¼n yettiÄŸi ve dualarÄ± duyduÄŸu", "YardÄ±mÄ±n hiÃ§ gelmeyeceÄŸi"], correctAnswer: "Allah'Ä±n her ÅŸeye gÃ¼cÃ¼nÃ¼n yettiÄŸi ve dualarÄ± duyduÄŸu", minAge: 15, maxAge: 18 },
                 { questionId: 414, segmentId: 4, questionText: "'KolaylÄ±k' sadece maddi rahatlama mÄ±dÄ±r, yoksa manevi ferahlama da olabilir mi?", options: ["Sadece maddidir", "Sadece manevidir", "Hem maddi hem manevi olabilir", "Metinde sadece maddi kastedilir"], correctAnswer: "Hem maddi hem manevi olabilir", minAge: 14, maxAge: 18 },
                 { questionId: 415, segmentId: 4, questionText: "SabÄ±r gÃ¶stermenin toplumsal faydalarÄ± neler olabilir?", options: ["Toplumda kargaÅŸa Ã§Ä±karÄ±r", "Ä°liÅŸkileri zayÄ±flatÄ±r", "AnlaÅŸmazlÄ±klarÄ± azaltÄ±r, huzuru artÄ±rÄ±r", "TembelliÄŸi teÅŸvik eder"], correctAnswer: "AnlaÅŸmazlÄ±klarÄ± azaltÄ±r, huzuru artÄ±rÄ±r", minAge: 15, maxAge: 18 },
            ];

            // --- AnlatÄ±m Metinleri ---
            const quizSegments = [
                 { segmentId: 1, narrationTitle: "Fatiha Suresi (Ayet 1-4)", narrationText: "RahmÃ¢n ve RahÃ®m olan Allah'Ä±n adÄ±yla. Hamd, Ã¢lemlerin Rabbi Allahâ€™a mahsustur. O, RahmÃ¢nâ€™dÄ±r, RahÃ®mâ€™dir. Hesap gÃ¼nÃ¼nÃ¼n sahibidir." },
                 { segmentId: 2, narrationTitle: "Hadis-i Åerif (Ameller ve Niyetler)", narrationText: "Peygamber Efendimiz sallallahu aleyhi ve sellem ÅŸÃ¶yle buyurmuÅŸtur: Ameller ancak niyetlere gÃ¶redir. Herkes iÃ§in ancak niyet ettiÄŸi ÅŸey vardÄ±r. Kimin hicreti Allah'a ve ResÃ»lÃ¼'ne ise, onun hicreti Allah'a ve ResÃ»lÃ¼'nedir. Kimin hicreti de elde edeceÄŸi bir dÃ¼nyalÄ±ÄŸa veya evleneceÄŸi bir kadÄ±na ise, onun hicreti de hicret ettiÄŸi ÅŸeyedir." },
                 { segmentId: 3, narrationTitle: "Ä°hlas Suresi", narrationText: "RahmÃ¢n ve RahÃ®m olan Allah'Ä±n adÄ±yla. De ki: O Allah birdir. Allah Samed'dir (Her ÅŸey O'na muhtaÃ§tÄ±r, O kimseye muhtaÃ§ deÄŸildir). O doÄŸurmamÄ±ÅŸ ve doÄŸmamÄ±ÅŸtÄ±r. HiÃ§bir ÅŸey O'na denk deÄŸildir." },
                 { segmentId: 4, narrationTitle: "SabrÄ±n Ã–nemi", narrationText: "SabÄ±r, imanÄ±n yarÄ±sÄ±dÄ±r. Zorluklar karÅŸÄ±sÄ±nda yÄ±lgÄ±nlÄ±k gÃ¶stermemek, aceleci davranmamak ve Allah'tan yardÄ±m dileyerek beklemektir. Sabredenler, sonunda mutlaka mÃ¼kafatlarÄ±nÄ± alÄ±rlar. UnutmayÄ±n, her zorlukla beraber bir kolaylÄ±k vardÄ±r." }
            ];

            // --- Oyuncu Bilgileri ---
            const players = [
                 { id: 1, name: "Oyuncu 1", age: 0, score: 0, answered: false, themeClass: '', currentQuestion: null },
                 { id: 2, name: "Oyuncu 2", age: 0, score: 0, answered: false, themeClass: '', currentQuestion: null },
                 { id: 3, name: "Oyuncu 3", age: 0, score: 0, answered: false, themeClass: '', currentQuestion: null }
            ];
            // --- DeÄŸiÅŸkenler ---
            let currentSegmentIndex = 0;
            let playersAnsweredCount = 0;
            let askedQuestionIds = []; // Sorulan soru ID'lerini tut

            // --- Element ReferanslarÄ± ---
            // DOM elementlerini burada alÄ±yoruz, DOMContentLoaded iÃ§inde olduÄŸu iÃ§in sorun olmaz
            const nameEntrySection = document.getElementById('name-entry');
            const confirmNamesButton = document.getElementById('confirm-names-button');
            const ttsSupportWarning = document.getElementById('tts-support-warning');
            const quizContent = document.getElementById('quiz-content');
            const narrationArea = document.getElementById('narration-area');
            const narrationInfo = document.getElementById('narration-info');
            const playNarrationButton = document.getElementById('play-narration-btn');
            const scoreboardElement = document.getElementById('scoreboard');
            const scoreboardListElement = document.getElementById('scoreboard-list');
            const playersArea = document.getElementById('players-area');
            const loadingIndicator = document.getElementById('loading-indicator');
            const resultsElement = document.getElementById('results');
            const finalScoresElement = document.getElementById('final-scores');
            const restartButton = document.getElementById('restart-button');
            const winnerInfoElement = document.getElementById('winner-info');
            const nameInputs = []; const ageInputs = []; const nameDisplays = []; const ageDisplays = [];
            const playerAreaElements = []; const playerQuestionElements = []; const playerOptionsElements = []; const playerFeedbackElements = [];

            for (let i = 1; i <= 3; i++) {
                nameInputs.push(document.getElementById(`player-${i}-name-input`));
                ageInputs.push(document.getElementById(`player-${i}-age-input`));
                nameDisplays.push(document.getElementById(`player-${i}-name-display`));
                ageDisplays.push(document.getElementById(`player-${i}-age-display`));
                playerAreaElements.push(document.getElementById(`player-area-${i}`));
                playerQuestionElements.push(document.getElementById(`question-player-${i}`));
                playerOptionsElements.push(document.getElementById(`options-player-${i}`));
                playerFeedbackElements.push(document.getElementById(`feedback-player-${i}`));
            }

             // --- Fonksiyonlar ---
             function shuffleArray(array) {
                 let currentIndex = array.length,  randomIndex;
                 while (currentIndex > 0) {
                     randomIndex = Math.floor(Math.random() * currentIndex);
                     currentIndex--;
                     [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
                 }
                 return array;
             }

             function updateScoreboard() {
                 scoreboardListElement.innerHTML = '';
                 players.forEach(player => {
                     const listItem = document.createElement('li');
                      // Temaya uygun renkli isimler (isteÄŸe baÄŸlÄ±)
                     const nameSpan = `<span class="name ${player.themeClass}">${player.name}</span>`;
                     listItem.innerHTML = `${nameSpan}: <span class="score">${player.score} Puan</span>`;
                     scoreboardListElement.appendChild(listItem);
                 });
             }

             function getThemeClass(age) {
                 if (age >= 7 && age <= 10) return 'theme-child';
                 if (age >= 11 && age <= 14) return 'theme-teen';
                 if (age >= 15 && age <= 18) return 'theme-young-adult';
                 return 'theme-default';
             }

             function loadSegment(segmentIndex) {
                 window.speechSynthesis.cancel();
                 if (segmentIndex >= quizSegments.length) {
                     showResults(); return;
                 }
                 currentSegmentIndex = segmentIndex;
                 const segmentData = quizSegments[segmentIndex];
                 playerAreaElements.forEach(el => el.classList.remove('visible')); // Ã–nce gizle
                 playersArea.style.display = 'none';
                 loadingIndicator.style.display = 'none';
                 narrationArea.style.display = 'block';
                 scoreboardElement.style.display = 'block';
                 narrationInfo.textContent = `Segment ${segmentIndex + 1}: "${segmentData.narrationTitle}" konusunu dinlemek iÃ§in butona basÄ±n.`;
                 playNarrationButton.disabled = false;
                 playNarrationButton.textContent = "AnlatÄ±mÄ± Seslendir";
                 players.forEach(player => {
                     if(playerFeedbackElements[player.id-1]) playerFeedbackElements[player.id-1].textContent = '';
                     if(playerAreaElements[player.id-1]) playerAreaElements[player.id-1].style.borderColor = 'transparent'; // BaÅŸlangÄ±Ã§ta border rengini sÄ±fÄ±rla
                 });
                 updateScoreboard();
             }

             function handleNarrationEnd() {
                 console.log("Seslendirme bitti, sorular yÃ¼kleniyor...");
                 playNarrationButton.textContent = "AnlatÄ±m Bitti";
                 playNarrationButton.disabled = true;
                 narrationArea.style.display = 'none';
                 loadingIndicator.style.display = 'block';
                 setTimeout(() => {
                     loadQuestionsForPlayers(currentSegmentIndex);
                     loadingIndicator.style.display = 'none';
                     playersArea.style.display = 'flex';
                     playerAreaElements.forEach(el => el.classList.add('visible')); // Åimdi gÃ¶ster
                 }, 500);
             }

             function loadQuestionsForPlayers(segmentIdx) {
                 playersAnsweredCount = 0;
                 let currentRoundSelectedIds = [];

                 players.forEach(player => {
                     player.answered = false;
                     player.currentQuestion = null;
                     const optionsEl = playerOptionsElements[player.id-1];
                     const feedbackEl = playerFeedbackElements[player.id-1];
                     const questionEl = playerQuestionElements[player.id-1];
                     const sectionEl = playerAreaElements[player.id-1];

                     if (optionsEl) optionsEl.innerHTML = '';
                     if (feedbackEl) feedbackEl.textContent = '';
                     if (questionEl) questionEl.textContent = 'Soru aranÄ±yor...';
                     if (sectionEl) sectionEl.style.borderColor = 'transparent'; // Tema rengi border'Ä± sÄ±fÄ±rla

                     const suitableQuestions = questionPool.filter(q =>
                         q.segmentId === quizSegments[segmentIdx].segmentId &&
                         player.age >= q.minAge &&
                         player.age <= q.maxAge &&
                         !askedQuestionIds.includes(q.questionId) &&
                         !currentRoundSelectedIds.includes(q.questionId)
                     );

                     let questionData = null;
                     if (suitableQuestions.length > 0) {
                         questionData = suitableQuestions[Math.floor(Math.random() * suitableQuestions.length)];
                         player.currentQuestion = questionData;
                         askedQuestionIds.push(questionData.questionId);
                         currentRoundSelectedIds.push(questionData.questionId);

                         if (questionEl) questionEl.textContent = questionData.questionText;
                         if (optionsEl) {
                             const shuffledOptions = shuffleArray([...questionData.options]);
                             shuffledOptions.forEach(option => {
                                 const button = document.createElement('button');
                                 button.textContent = option;
                                 button.onclick = () => handleAnswer(player.id, option);
                                 optionsEl.appendChild(button);
                             });
                         }
                     } else {
                         if (questionEl) questionEl.textContent = 'Size uygun soru bulunamadÄ±.';
                         player.answered = true;
                         playersAnsweredCount++;
                     }
                 });

                 if (playersAnsweredCount === players.length && playersAnsweredCount > 0) { // EÄŸer hepsi iÃ§in soru bulunamadÄ±ysa
                    console.log("Bu turda kimseye soru bulunamadÄ± veya hepsi otomatik geÃ§ildi.");
                    loadingIndicator.style.display = 'block';
                    playersArea.style.display = 'none';
                    setTimeout(() => loadSegment(currentSegmentIndex + 1), 1800);
                 }
             }


             function handleAnswer(playerId, selectedOption) {
                 const player = players.find(p => p.id === playerId);
                 if (!player || player.answered || !player.currentQuestion) return;

                 player.answered = true;
                 playersAnsweredCount++;

                 const feedbackEl = playerFeedbackElements[player.id-1];
                 const sectionEl = playerAreaElements[player.id-1];
                 const playerOptionButtons = playerOptionsElements[player.id-1].getElementsByTagName('button');

                 // Kontrol: Elementler null deÄŸilse iÅŸlem yap
                 if (!feedbackEl || !sectionEl || !playerOptionButtons) {
                     console.error(`Oyuncu ${playerId} iÃ§in elementler bulunamadÄ±.`);
                     return;
                 }


                 for(let btn of playerOptionButtons){ btn.disabled = true; }

                 if (selectedOption === player.currentQuestion.correctAnswer) {
                     player.score++;
                     feedbackEl.textContent = "DoÄŸru!";
                     feedbackEl.className = 'player-feedback feedback-correct';
                     // Tema rengini koruyarak border ekle
                     sectionEl.style.borderColor = getComputedStyle(sectionEl).getPropertyValue('--theme-' + player.themeClass.split('-')[1] + '-border') || 'var(--correct-border)';

                 } else {
                     feedbackEl.textContent = `YanlÄ±ÅŸ!`;
                     feedbackEl.className = 'player-feedback feedback-incorrect';
                     sectionEl.style.borderColor = 'var(--incorrect-border)';
                 }
                 // scoreEl.textContent = `Skor: ${player.score}`; // Gerek yok, skorbord var

                 updateScoreboard();

                 if(playersAnsweredCount === players.length) {
                     console.log("Tur tamamlandÄ±, sonraki segmente geÃ§iliyor.");
                     loadingIndicator.style.display = 'block';
                     playerAreaElements.forEach(el => el.classList.remove('visible')); // Gizle
                     playersArea.style.display = 'none';
                     setTimeout(() => {
                         loadSegment(currentSegmentIndex + 1);
                     }, 1800);
                 }
             }

             function showResults() {
                 quizContent.style.display = 'none';
                 resultsElement.style.display = 'block';
                 finalScoresElement.innerHTML = '';
                 let maxScore = -1;
                 let winners = [];
                 const sortedPlayers = [...players].sort((a, b) => b.score - a.score);
                 sortedPlayers.forEach(player => {
                      const resultLine = document.createElement('div');
                      resultLine.classList.add('result-line');
                      resultLine.innerHTML = `<span class="name ${player.themeClass}">${player.name} (${player.age} yaÅŸ)</span> <span class="score">${player.score} Puan</span>`;
                      finalScoresElement.appendChild(resultLine);
                      if (player.score > maxScore) { maxScore = player.score; winners = [player.name]; }
                      else if (player.score === maxScore && maxScore >= 0) { winners.push(player.name); }
                 });
                  if (maxScore <= 0 ) { winnerInfoElement.textContent = "Kimse puan alamadÄ± veya yeterli soru bulunamadÄ±!"; }
                  else if (winners.length > 1) { winnerInfoElement.textContent = `Kazananlar (Berabere): ${winners.join(', ')} (${maxScore} puan)`; }
                  else { winnerInfoElement.textContent = `ğŸ† Kazanan: ${winners[0]} (${maxScore} puan)! ğŸ‰`; }
            }

             function initializeQuiz() {
                 let allAgesValid = true;
                 players.forEach((player, index) => {
                     const name = nameInputs[index].value.trim();
                     const age = parseInt(ageInputs[index].value);
                     player.name = name === '' ? `Oyuncu ${player.id}` : name;
                     if (isNaN(age) || age < 7 || age > 18) {
                         alert(`Oyuncu ${player.id} iÃ§in geÃ§erli bir yaÅŸ (7-18 arasÄ±) girin.`);
                         allAgesValid = false;
                     } else {
                         player.age = age;
                         player.themeClass = getThemeClass(age);
                     }
                     player.score = 0; player.answered = false; player.currentQuestion = null;
                 });

                 if (!allAgesValid) return;

                 players.forEach((player, index) => {
                      // Elementlerin varlÄ±ÄŸÄ±nÄ± kontrol et
                     const areaEl = playerAreaElements[player.id - 1];
                     const nameEl = nameDisplays[player.id - 1];
                     const ageEl = ageDisplays[player.id - 1];

                     if (areaEl) {
                         areaEl.className = `player-quiz-area ${player.themeClass}`; // TemayÄ± uygula
                         areaEl.style.borderColor = 'transparent'; // BaÅŸlangÄ±Ã§ border'Ä±nÄ± gizle
                     } else { console.error(`player-area-${player.id} bulunamadÄ±`); }

                     if (nameEl) { nameEl.textContent = player.name; }
                     else { console.error(`player-${player.id}-name-display bulunamadÄ±`); }

                     if (ageEl) { ageEl.textContent = `(${player.age} yaÅŸ)`; }
                     else { console.error(`player-${player.id}-age-display bulunamadÄ±`); }

                    // Skor baÅŸlangÄ±Ã§ta skorbordda gÃ¶rÃ¼necek, bireysel alanda gÃ¶stermeye gerek yok
                    // const scoreEl = document.getElementById(`score-player-${player.id}`);
                    // if(scoreEl) scoreEl.textContent = `Skor: 0`;
                 });

                 nameEntrySection.style.display = 'none';
                 resultsElement.style.display = 'none';
                 quizContent.style.display = 'block';
                 startQuiz();
             }

             function startQuiz() {
                 askedQuestionIds = [];
                 currentSegmentIndex = 0;
                 players.forEach(p => { p.score = 0; }); // SkorlarÄ± sÄ±fÄ±rla
                 updateScoreboard();
                 loadSegment(currentSegmentIndex);
             }

             function resetToNameEntry() {
                 window.speechSynthesis.cancel();
                 quizContent.style.display = 'none';
                 resultsElement.style.display = 'none';
                 nameEntrySection.style.display = 'block';
                 checkTtsSupport();
             }

             function checkTtsSupport() {
                 if (!('speechSynthesis' in window) || !window.speechSynthesis) {
                     ttsSupportWarning.style.display = 'block';
                      if(confirmNamesButton) confirmNamesButton.disabled = true; // Buton varsa disable et
                 } else {
                     ttsSupportWarning.style.display = 'none';
                     if(confirmNamesButton) confirmNamesButton.disabled = false;
                 }
             }

            // --- Olay Dinleyicileri ---
            // Elementlerin varlÄ±ÄŸÄ±nÄ± kontrol ederek listener ekle
             if (confirmNamesButton) {
                confirmNamesButton.addEventListener('click', initializeQuiz);
             } else { console.error("confirmNamesButton bulunamadÄ±!"); }

             if (restartButton) {
                restartButton.addEventListener('click', resetToNameEntry);
             } else { console.error("restartButton bulunamadÄ±!"); }

             if (playNarrationButton) {
                playNarrationButton.addEventListener('click', () => {
                    if (!('speechSynthesis' in window) || !window.speechSynthesis) { alert("TTS desteklenmiyor."); return; }
                    window.speechSynthesis.cancel();
                    const segmentData = quizSegments[currentSegmentIndex];
                    if (!segmentData || !segmentData.narrationText) { console.error("Seslendirilecek metin yok!"); alert("Metin yok!"); return; }
                    const utterance = new SpeechSynthesisUtterance(segmentData.narrationText);
                    utterance.lang = 'tr-TR'; utterance.rate = 0.9; utterance.pitch = 1;
                    utterance.onend = handleNarrationEnd;
                    utterance.onerror = (event) => { console.error('TTS HatasÄ±:', event); alert(`Seslendirme hatasÄ±: ${event.error}`); playNarrationButton.textContent = "Hata!"; playNarrationButton.disabled = false; };
                    playNarrationButton.disabled = true; playNarrationButton.textContent = "Seslendiriliyor...";
                    window.speechSynthesis.speak(utterance);
                });
             } else { console.error("playNarrationButton bulunamadÄ±!"); }


            // --- BaÅŸlangÄ±Ã§ ---
            resetToNameEntry(); // Sayfa ilk yÃ¼klendiÄŸinde isim giriÅŸi ekranÄ±nÄ± gÃ¶ster

        }); // DOMContentLoaded Sonu
    </script>

</body>
</html>
