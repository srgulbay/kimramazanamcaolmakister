<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YaÅŸa Ã–zel AlanlÄ± Ä°slami Bilgi YarÄ±ÅŸmasÄ±</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap');

        /* --- Renk TemalarÄ± --- */
        :root {
            --primary-bg: linear-gradient(135deg, #72EDF2, #5151E5); /* Yeni arkaplan */
            --container-bg: rgba(255, 255, 255, 0.98);
            --question-bg: #e8eaf6;
            --scoreboard-bg: #eceff1;
            --primary-text: #333;
            --header-color: #3f51b5;
            --subheader-color: #5e35b1;
            --winner-color: #ff6f00;

             /* YaÅŸ Grubu Renkleri (Ã–rnek) */
            --theme-child-bg: #e0f7fa;
            --theme-child-border: #4dd0e1;
            --theme-child-header: #0097a7;
            --theme-child-button: linear-gradient(145deg, #26c6da, #00acc1);
            --theme-child-button-hover: linear-gradient(145deg, #00acc1, #26c6da);

            --theme-teen-bg: #e8f5e9;
            --theme-teen-border: #81c784;
            --theme-teen-header: #388e3c;
            --theme-teen-button: linear-gradient(145deg, #66bb6a, #43a047);
            --theme-teen-button-hover: linear-gradient(145deg, #43a047, #66bb6a);

            --theme-young-adult-bg: #f3e5f5;
            --theme-young-adult-border: #ce93d8;
            --theme-young-adult-header: #8e24aa;
            --theme-young-adult-button: linear-gradient(145deg, #ab47bc, #8e24aa);
            --theme-young-adult-button-hover: linear-gradient(145deg, #8e24aa, #ab47bc);

             /* DiÄŸer renkler */
             --correct-color: #2e7d32;
             --incorrect-color: #c62828;
        }

        body {
            font-family: 'Poppins', sans-serif; display: flex; justify-content: center; align-items: flex-start; min-height: 100vh; background: var(--primary-bg); color: var(--primary-text); padding: 10px; box-sizing: border-box;
        }
        #quiz-container {
            background-color: var(--container-bg); padding: 20px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15); text-align: center; width: 100%; max-width: 1200px; /* Daha geniÅŸ container */
        }
        h1, h2 { color: var(--header-color); margin-bottom: 20px; }
        h2 { color: var(--subheader-color); font-size: 1.5em; }
        h3 { color: var(--subheader-color); font-size: 1.2em; margin-bottom: 10px; }

        /* --- Ä°sim/YaÅŸ GiriÅŸ AlanÄ± --- */
        #name-entry { padding: 20px; border: 1px solid #ddd; border-radius: 10px; margin-bottom: 20px; background-color: #fafafa; display: flex; flex-wrap: wrap; justify-content: space-around; gap: 15px; }
        .player-input-group { flex: 1 1 250px; text-align: left; background: #fff; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);}
        .player-input-group label { display: block; margin-bottom: 5px; font-weight: 600; color: var(--subheader-color); }
        .player-input-group input { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 5px; font-size: 1em; box-sizing: border-box; margin-bottom: 5px; }
        #confirm-container { width: 100%; text-align: center; margin-top: 15px; }

        /* --- Quiz Ä°Ã§eriÄŸi --- */
        #quiz-content { display: none; }

        /* --- Ortak Alanlar --- */
        #narration-area { margin-bottom: 20px; padding: 15px; background-color: var(--question-bg); border-radius: 10px; text-align: center; }
        #narration-area p { font-style: italic; color: #555; margin-bottom: 15px; }
        #play-narration-btn { padding: 10px 20px; font-size: 1em; cursor: pointer; background: var(--start-button-gradient); color: white; border: none; border-radius: 8px; transition: background-color 0.3s; }
        #play-narration-btn:disabled { background-color: #aaa; cursor: not-allowed; }

        #scoreboard { background-color: var(--scoreboard-bg); padding: 10px 15px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        #scoreboard h3 { margin: 0 0 10px 0; color: var(--subheader-color); font-size: 1.1em; }
        #scoreboard-list { list-style: none; padding: 0; margin: 0; display: flex; justify-content: space-around; text-align: center; }
        #scoreboard-list li { font-size: 1em; padding: 5px; }
        #scoreboard-list .name { font-weight: 600; }
        #scoreboard-list .score { font-weight: bold; margin-left: 5px; }


        /* --- Oyuncu AlanlarÄ± (Yan Yana 3 SÃ¼tun) --- */
        #players-area {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap; /* KÃ¼Ã§Ã¼k ekranlar iÃ§in alta kaydÄ±r */
            gap: 15px; /* Alanlar arasÄ± boÅŸluk */
        }
        .player-quiz-area {
            flex: 1 1 30%; /* EÅŸit geniÅŸlik, esneklik */
            min-width: 280px; /* Minimum geniÅŸlik */
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-top: 5px solid; /* Tema rengi iÃ§in Ã¼st border */
            transition: border-color 0.5s ease;
            text-align: center;
             opacity: 0; /* BaÅŸlangÄ±Ã§ta gizli */
             transition: opacity 0.5s ease;
        }
        .player-quiz-area.visible {
            opacity: 1;
        }


        /* --- Tema Renkleri --- */
        .theme-child { background-color: var(--theme-child-bg); border-color: var(--theme-child-border); }
        .theme-teen { background-color: var(--theme-teen-bg); border-color: var(--theme-teen-border); }
        .theme-young-adult { background-color: var(--theme-young-adult-bg); border-color: var(--theme-young-adult-border); }

        /* Oyuncu AlanÄ± Ä°Ã§indeki Elementler */
        .player-info { margin-bottom: 15px; font-weight: 600; font-size: 1.1em; }
        .player-info .player-age { font-size: 0.9em; color: #555; margin-left: 5px; }
        .theme-child .player-info { color: var(--theme-child-header); }
        .theme-teen .player-info { color: var(--theme-teen-header); }
        .theme-young-adult .player-info { color: var(--theme-young-adult-header); }

        .player-question {
            min-height: 70px; /* Soru alanÄ± yÃ¼ksekliÄŸi */
            margin-bottom: 15px;
            padding: 10px;
            background-color: rgba(255,255,255, 0.7);
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.05em; /* Oyuncu alanÄ± iÃ§inde biraz daha kÃ¼Ã§Ã¼k */
            font-weight: 600;
            line-height: 1.4;
        }

        .player-options button {
            display: block;
            width: 100%;
            padding: 9px; /* Biraz daha kÃ¼Ã§Ã¼k butonlar */
            margin: 6px 0;
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.15);
        }
         /* Tema Buton Renkleri */
         .theme-child .player-options button { background: var(--theme-child-button); }
         .theme-child .player-options button:hover:not(:disabled) { background: var(--theme-child-button-hover); }
         .theme-teen .player-options button { background: var(--theme-teen-button); }
         .theme-teen .player-options button:hover:not(:disabled) { background: var(--theme-teen-button-hover); }
         .theme-young-adult .player-options button { background: var(--theme-young-adult-button); }
         .theme-young-adult .player-options button:hover:not(:disabled) { background: var(--theme-young-adult-button-hover); }

        .player-options button:disabled { background: #cccccc !important; cursor: not-allowed; opacity: 0.7; transform: none; box-shadow: none; }

        .player-feedback {
            min-height: 20px;
            margin-top: 10px;
            font-weight: 600;
            font-size: 0.9em;
        }
        .feedback-correct { color: var(--correct-color); }
        .feedback-incorrect { color: var(--incorrect-color); }

        /* --- SonuÃ§ AlanÄ± (Ã–nceki gibi) --- */
        #results { display: none; margin-top: 30px; }
        #final-scores { margin-bottom: 20px;}
        .result-line { font-size: 1.2em; margin: 10px 0; padding: 8px; border-radius: 5px; background-color: #f0f0f0; display: flex; justify-content: space-between; }
        .result-line .name { font-weight: 600; flex-grow: 1; text-align: left; margin-right: 10px; }
        .result-line .score { font-weight: bold; }
        #winner-info { font-size: 1.4em; font-weight: bold; color: var(--winner-color); margin-top: 15px; }
        #confirm-names-button, #restart-button { padding: 12px 25px; font-size: 1.2em; font-weight: 600; cursor: pointer; margin-top: 20px; background: var(--start-button-gradient); color: white; border: none; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.15); transition: all 0.3s ease; }
        #confirm-names-button:hover, #restart-button:hover { background: var(--start-button-hover-gradient); box-shadow: 0 6px 12px rgba(0,0,0,0.2); transform: translateY(-2px); }

        /* --- YÃ¼klenme GÃ¶stergesi --- */
        #loading-indicator {
             display: none; /* BaÅŸlangÄ±Ã§ta gizli */
             font-size: 1.2em;
             color: var(--subheader-color);
             margin: 20px;
             font-weight: bold;
         }

    </style>
</head>
<body>
    <div id="quiz-container">
        <h1>YaÅŸa Ã–zel AlanlÄ± Ä°slami Bilgi YarÄ±ÅŸmasÄ±</h1>

        <div id="name-entry">
            <div class="player-input-group">
                <label for="player-1-name-input">Oyuncu 1 AdÄ±:</label>
                <input type="text" id="player-1-name-input" placeholder="Ä°sim..." maxlength="20">
                <label for="player-1-age-input">YaÅŸÄ± (7-18):</label>
                <input type="number" id="player-1-age-input" min="7" max="18" placeholder="YaÅŸ...">
            </div>
            <div class="player-input-group">
                <label for="player-2-name-input">Oyuncu 2 AdÄ±:</label>
                <input type="text" id="player-2-name-input" placeholder="Ä°sim..." maxlength="20">
                <label for="player-2-age-input">YaÅŸÄ± (7-18):</label>
                <input type="number" id="player-2-age-input" min="7" max="18" placeholder="YaÅŸ...">
            </div>
            <div class="player-input-group">
                <label for="player-3-name-input">Oyuncu 3 AdÄ±:</label>
                <input type="text" id="player-3-name-input" placeholder="Ä°sim..." maxlength="20">
                <label for="player-3-age-input">YaÅŸÄ± (7-18):</label>
                <input type="number" id="player-3-age-input" min="7" max="18" placeholder="YaÅŸ...">
            </div>
            <div id="confirm-container">
                <button id="confirm-names-button">YarÄ±ÅŸmayÄ± BaÅŸlat</button>
            </div>
            <p id="tts-support-warning" style="color: red; width: 100%; text-align: center; margin-top: 10px; display: none;">TarayÄ±cÄ±nÄ±z metin seslendirme Ã¶zelliÄŸini desteklemiyor olabilir.</p>
        </div>

        <div id="quiz-content">
            <div id="narration-area" style="display: none;">
                <p id="narration-info">Åimdi dikkatle dinleyin...</p>
                <button id="play-narration-btn">AnlatÄ±mÄ± Seslendir</button>
            </div>

             <div id="loading-indicator">SÄ±radaki sorular hazÄ±rlanÄ±yor...</div>

            <div id="scoreboard" style="display: none;">
                 <h3>Skor Tablosu</h3>
                 <ul id="scoreboard-list"></ul>
            </div>

            <div id="players-area">
                 <div class="player-quiz-area" id="player-area-1">
                    <div class="player-info">
                        <span class="player-name" id="player-1-name-display"></span>
                        <span class="player-age" id="player-1-age-display"></span>
                    </div>
                    <div class="player-question" id="question-player-1">Soru yÃ¼kleniyor...</div>
                    <div class="player-options" id="options-player-1"></div>
                    <div class="player-feedback" id="feedback-player-1"></div>
                 </div>
                 <div class="player-quiz-area" id="player-area-2">
                    <div class="player-info">
                        <span class="player-name" id="player-2-name-display"></span>
                        <span class="player-age" id="player-2-age-display"></span>
                     </div>
                    <div class="player-question" id="question-player-2">Soru yÃ¼kleniyor...</div>
                    <div class="player-options" id="options-player-2"></div>
                    <div class="player-feedback" id="feedback-player-2"></div>
                 </div>
                 <div class="player-quiz-area" id="player-area-3">
                     <div class="player-info">
                        <span class="player-name" id="player-3-name-display"></span>
                        <span class="player-age" id="player-3-age-display"></span>
                    </div>
                    <div class="player-question" id="question-player-3">Soru yÃ¼kleniyor...</div>
                    <div class="player-options" id="options-player-3"></div>
                    <div class="player-feedback" id="feedback-player-3"></div>
                 </div>
            </div>
        </div>

        <div id="results">
             <h2>YarÄ±ÅŸma Bitti!</h2>
             <div id="final-scores"></div>
             <p id="winner-info"></p>
             <button id="restart-button">Yeni Oyun (Yeni Ä°simlerle)</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- SORU HAVUZU (Ã–rnek - GeniÅŸletilmeli) ---
            // Her soru: questionId, segmentId (hangi anlatÄ±ma ait), text, options, answer, minAge, maxAge
            const questionPool = [
                // Segment 1 (Fatiha) SorularÄ±
                { questionId: 101, segmentId: 1, questionText: "Metnin baÅŸÄ±nda geÃ§en 'RahmÃ¢n' ne anlama gelir?", options: ["Ã‡ok GÃ¼Ã§lÃ¼", "Ã‡ok Merhametli", "Her Åeyi Bilen", "Tek Olan"], correctAnswer: "Ã‡ok Merhametli", minAge: 7, maxAge: 10 },
                { questionId: 102, segmentId: 1, questionText: "'Ã‚lemlerin Rabbi' ifadesi neyi anlatÄ±r?", options: ["Sadece insanlarÄ±n sahibi", "Sadece meleklerin sahibi", "TÃ¼m evrenin ve iÃ§indekilerin sahibi/yÃ¶neticisi", "Sadece dÃ¼nyanÄ±n sahibi"], correctAnswer: "TÃ¼m evrenin ve iÃ§indekilerin sahibi/yÃ¶neticisi", minAge: 9, maxAge: 14 },
                { questionId: 103, segmentId: 1, questionText: "Metinde geÃ§en ve 'din gÃ¼nÃ¼' olarak da bilinen gÃ¼n hangisidir?", options: ["Kadir Gecesi", "Cuma GÃ¼nÃ¼", "Hesap GÃ¼nÃ¼", "AÅŸure GÃ¼nÃ¼"], correctAnswer: "Hesap GÃ¼nÃ¼", minAge: 11, maxAge: 18 },
                { questionId: 104, segmentId: 1, questionText: "Fatiha suresinin ilk ayeti nedir?", options: ["Hamd, alemlerin Rabbinedir", "Allah'Ä±n adÄ±yla baÅŸlarÄ±m", "O RahmandÄ±r", "Din gÃ¼nÃ¼nÃ¼n sahibidir"], correctAnswer: "Allah'Ä±n adÄ±yla baÅŸlarÄ±m", minAge: 7, maxAge: 18 }, // Daha genel
                 { questionId: 105, segmentId: 1, questionText: "Hangi kelime 'Ã¶vgÃ¼, ÅŸÃ¼kÃ¼r' anlamÄ±na gelir?", options: ["Rab", "Rahim", "Din", "Hamd"], correctAnswer: "Hamd", minAge: 8, maxAge: 12 },

                // Segment 2 (Niyet Hadisi) SorularÄ±
                { questionId: 201, segmentId: 2, questionText: "Hadise gÃ¶re yaptÄ±ÄŸÄ±mÄ±z iÅŸlerin deÄŸeri neye baÄŸlÄ±dÄ±r?", options: ["GÃ¶rÃ¼nÃ¼ÅŸÃ¼ne", "Niyetimize", "Sonucuna", "BaÅŸkalarÄ±nÄ±n gÃ¶rmesine"], correctAnswer: "Niyetimize", minAge: 7, maxAge: 11 },
                { questionId: 202, segmentId: 2, questionText: "Bir kiÅŸi sadece dÃ¼nyalÄ±k bir kazanÃ§ iÃ§in 'hicret' ederse (bir iÅŸ yaparsa), karÅŸÄ±lÄ±ÄŸÄ± ne olur?", options: ["Cennet", "Cehennem", "Hem dÃ¼nyalÄ±k hem ahiretlik", "Sadece o dÃ¼nyalÄ±k kazanÃ§"], correctAnswer: "Sadece o dÃ¼nyalÄ±k kazanÃ§", minAge: 10, maxAge: 15 },
                { questionId: 203, segmentId: 2, questionText: "Hadisin ana mesajÄ± nedir?", options: ["Ã‡ok Ã§alÄ±ÅŸmak gerektiÄŸi", "Niyetin amellerdeki Ã¶nemi", "Hicret etmenin zorunluluÄŸu", "KadÄ±nlarla evlenmenin fazileti"], correctAnswer: "Niyetin amellerdeki Ã¶nemi", minAge: 12, maxAge: 18 },
                { questionId: 204, segmentId: 2, questionText: "Kimin hicreti Allah ve ResulÃ¼ iÃ§in kabul edilir?", options: ["ParasÄ± Ã§ok olanÄ±n", "Niyeti Allah ve ResulÃ¼ olanÄ±n", "HÄ±zlÄ± gidenin", "Gizlice yapanÄ±n"], correctAnswer: "Niyeti Allah ve ResulÃ¼ olanÄ±n", minAge: 9, maxAge: 18 }, // Daha genel
                { questionId: 205, segmentId: 2, questionText: "Hadiste geÃ§en 'Resul' kimdir?", options: ["Bir melek", "Peygamber Efendimiz (sav)", "Bir kral", "Bir alim"], correctAnswer: "Peygamber Efendimiz (sav)", minAge: 8, maxAge: 13 },

                // Segment 3 (Ä°hlas Suresi) SorularÄ±
                { questionId: 301, segmentId: 3, questionText: "Ä°hlas suresine gÃ¶re Allah kaÃ§tÄ±r?", options: ["Ä°ki", "ÃœÃ§", "SayÄ±sÄ±z", "Bir"], correctAnswer: "Bir", minAge: 7, maxAge: 9 },
                { questionId: 302, segmentId: 3, questionText: "'Samed' kelimesinin anlamÄ± nedir?", options: ["Affeden", "CezalandÄ±ran", "Herkesin muhtaÃ§ olduÄŸu", "GÃ¶ren"], correctAnswer: "Herkesin muhtaÃ§ olduÄŸu", minAge: 10, maxAge: 14 },
                { questionId: 303, segmentId: 3, questionText: "Allah'Ä±n doÄŸurmamÄ±ÅŸ ve doÄŸmamÄ±ÅŸ olmasÄ± ne anlama gelir?", options: ["Ã‡ok yaÅŸlÄ± olduÄŸu", "Anne/babasÄ± ve Ã§ocuÄŸu olmadÄ±ÄŸÄ±", "GÃ¶rÃ¼nmez olduÄŸu", "Ã‡ok hÄ±zlÄ± olduÄŸu"], correctAnswer: "Anne/babasÄ± ve Ã§ocuÄŸu olmadÄ±ÄŸÄ±", minAge: 9, maxAge: 15 },
                { questionId: 304, segmentId: 3, questionText: "Allah'Ä±n eÅŸi ve benzeri var mÄ±dÄ±r?", options: ["Evet, melekler", "Evet, peygamberler", "HayÄ±r, yoktur", "Bazen vardÄ±r"], correctAnswer: "HayÄ±r, yoktur", minAge: 7, maxAge: 18 }, // Genel
                 { questionId: 305, segmentId: 3, questionText: "Bu sure temel olarak Allah'Ä±n hangi Ã¶zelliÄŸini anlatÄ±r?", options: ["AffediciliÄŸini", "CÃ¶mertliÄŸini", "BirliÄŸini (Tevhid)", "Adaletini"], correctAnswer: "BirliÄŸini (Tevhid)", minAge: 11, maxAge: 18 },

                 // Segment 4 (SabÄ±r) SorularÄ±
                 { questionId: 401, segmentId: 4, questionText: "SabÄ±r neyin yarÄ±sÄ± olarak tarif ediliyor?", options: ["AklÄ±n", "ZenginliÄŸin", "Ä°manÄ±n", "SaÄŸlÄ±ÄŸÄ±n"], correctAnswer: "Ä°manÄ±n", minAge: 8, maxAge: 12 },
                 { questionId: 402, segmentId: 4, questionText: "Zorluklar karÅŸÄ±sÄ±nda ne yapmamalÄ±yÄ±z?", options: ["Dua etmek", "Beklemek", "Aceleci davranmak", "YardÄ±m istemek"], correctAnswer: "Aceleci davranmak", minAge: 7, maxAge: 11 },
                 { questionId: 403, segmentId: 4, questionText: "Metne gÃ¶re her zorlukla beraber ne vardÄ±r?", options: ["Daha bÃ¼yÃ¼k zorluk", "PiÅŸmanlÄ±k", "Bir kolaylÄ±k", "YalnÄ±zlÄ±k"], correctAnswer: "Bir kolaylÄ±k", minAge: 7, maxAge: 18 }, // Genel
                 { questionId: 404, segmentId: 4, questionText: "Sabredenler sonunda neye ulaÅŸÄ±r?", options: ["HiÃ§bir ÅŸeye", "MÃ¼kafatlarÄ±na", "YorgunluÄŸa", "Korkuya"], correctAnswer: "MÃ¼kafatlarÄ±na", minAge: 9, maxAge: 14 },
                 { questionId: 405, segmentId: 4, questionText: "Sabretmek ne demektir?", options: ["HiÃ§bir ÅŸey yapmamak", "Sadece aÄŸlamak", "ZorluÄŸa dayanÄ±p Allah'tan yardÄ±m beklemek", "Ä°syan etmek"], correctAnswer: "ZorluÄŸa dayanÄ±p Allah'tan yardÄ±m beklemek", minAge: 10, maxAge: 18 }, // Genel

                // ... Buraya yÃ¼zlerce soru eklenebilir ...
            ];

            // --- AnlatÄ±m Metinleri ---
            const quizSegments = [
                { segmentId: 1, narrationTitle: "Fatiha Suresi (Ayet 1-4)", narrationText: "RahmÃ¢n ve RahÃ®m olan Allah'Ä±n adÄ±yla. Hamd, Ã¢lemlerin Rabbi Allahâ€™a mahsustur. O, RahmÃ¢nâ€™dÄ±r, RahÃ®mâ€™dir. Hesap gÃ¼nÃ¼nÃ¼n sahibidir." },
                { segmentId: 2, narrationTitle: "Hadis-i Åerif (Ameller ve Niyetler)", narrationText: "Peygamber Efendimiz sallallahu aleyhi ve sellem ÅŸÃ¶yle buyurmuÅŸtur: Ameller ancak niyetlere gÃ¶redir. Herkes iÃ§in ancak niyet ettiÄŸi ÅŸey vardÄ±r. Kimin hicreti Allah'a ve ResÃ»lÃ¼'ne ise, onun hicreti Allah'a ve ResÃ»lÃ¼'nedir. Kimin hicreti de elde edeceÄŸi bir dÃ¼nyalÄ±ÄŸa veya evleneceÄŸi bir kadÄ±na ise, onun hicreti de hicret ettiÄŸi ÅŸeyedir." },
                { segmentId: 3, narrationTitle: "Ä°hlas Suresi", narrationText: "RahmÃ¢n ve RahÃ®m olan Allah'Ä±n adÄ±yla. De ki: O Allah birdir. Allah Samed'dir (Her ÅŸey O'na muhtaÃ§tÄ±r, O kimseye muhtaÃ§ deÄŸildir). O doÄŸurmamÄ±ÅŸ ve doÄŸmamÄ±ÅŸtÄ±r. HiÃ§bir ÅŸey O'na denk deÄŸildir." },
                 { segmentId: 4, narrationTitle: "SabrÄ±n Ã–nemi", narrationText: "SabÄ±r, imanÄ±n yarÄ±sÄ±dÄ±r. Zorluklar karÅŸÄ±sÄ±nda yÄ±lgÄ±nlÄ±k gÃ¶stermemek, aceleci davranmamak ve Allah'tan yardÄ±m dileyerek beklemektir. Sabredenler, sonunda mutlaka mÃ¼kafatlarÄ±nÄ± alÄ±rlar. UnutmayÄ±n, her zorlukla beraber bir kolaylÄ±k vardÄ±r." }
                // ... DiÄŸer segmentler ...
            ];


            // --- Oyuncu Bilgileri ---
            const players = [
                { id: 1, name: "Oyuncu 1", age: 0, score: 0, answered: false, themeClass: '', currentQuestion: null },
                { id: 2, name: "Oyuncu 2", age: 0, score: 0, answered: false, themeClass: '', currentQuestion: null },
                { id: 3, name: "Oyuncu 3", age: 0, score: 0, answered: false, themeClass: '', currentQuestion: null }
            ];

            // --- DeÄŸiÅŸkenler ---
            let currentSegmentIndex = 0;
            //let currentQuestionSubIndex = 0; // ArtÄ±k kullanÄ±lmÄ±yor, her oyuncu kendi sorusunu alÄ±yor
            //let totalQuestionsAnswered = 0; // Takip etmek zorlaÅŸtÄ±, segment bazlÄ± ilerleyelim
            let playersAnsweredCount = 0; // Mevcut TURDA cevaplayan oyuncu sayÄ±sÄ±
            let askedQuestionIds = []; // Sorulan soru ID'lerini tutalÄ±m (tekrarÄ± Ã¶nlemek iÃ§in)

            // --- Element ReferanslarÄ± ---
            const nameEntrySection = document.getElementById('name-entry');
            const confirmNamesButton = document.getElementById('confirm-names-button');
            const ttsSupportWarning = document.getElementById('tts-support-warning');
            const quizContent = document.getElementById('quiz-content');
            const narrationArea = document.getElementById('narration-area');
            const narrationInfo = document.getElementById('narration-info');
            const playNarrationButton = document.getElementById('play-narration-btn');
            //const questionDisplayArea = ...; // ArtÄ±k ortak deÄŸil
            const scoreboardElement = document.getElementById('scoreboard');
            const scoreboardListElement = document.getElementById('scoreboard-list');
            const playersArea = document.getElementById('players-area'); // Oyuncu alanlarÄ±nÄ±n kapsayÄ±cÄ±sÄ±
            const loadingIndicator = document.getElementById('loading-indicator'); // Yeni
            const resultsElement = document.getElementById('results');
            const finalScoresElement = document.getElementById('final-scores');
            const restartButton = document.getElementById('restart-button');
            const winnerInfoElement = document.getElementById('winner-info');
            const nameInputs = []; const ageInputs = []; const nameDisplays = []; const ageDisplays = [];
            const playerAreaElements = []; const playerQuestionElements = []; const playerOptionsElements = []; const playerFeedbackElements = [];

            for (let i = 1; i <= 3; i++) {
                nameInputs.push(document.getElementById(`player-${i}-name-input`));
                ageInputs.push(document.getElementById(`player-${i}-age-input`)); // YaÅŸ inputlarÄ±
                nameDisplays.push(document.getElementById(`player-${i}-name-display`));
                ageDisplays.push(document.getElementById(`player-${i}-age-display`)); // YaÅŸ gÃ¶sterimleri
                playerAreaElements.push(document.getElementById(`player-area-${i}`));
                playerQuestionElements.push(document.getElementById(`question-player-${i}`));
                playerOptionsElements.push(document.getElementById(`options-player-${i}`));
                playerFeedbackElements.push(document.getElementById(`feedback-player-${i}`));
            }


            // --- Fonksiyonlar ---
            function shuffleArray(array) { /* ... Ã–nceki gibi ... */ }
            function updateScoreboard() {
                 // Skorbord artÄ±k oyuncu isimlerini ve skorlarÄ±nÄ± listeleyecek
                 scoreboardListElement.innerHTML = ''; // Temizle
                 players.forEach(player => {
                     const listItem = document.createElement('li');
                     listItem.innerHTML = `<span class="name">${player.name}</span>: <span class="score">${player.score} Puan</span>`;
                     // Ä°steÄŸe baÄŸlÄ±: Skor sÄ±rasÄ±na gÃ¶re class ekleyebiliriz
                     scoreboardListElement.appendChild(listItem);
                 });
            }

            // YaÅŸa gÃ¶re tema sÄ±nÄ±fÄ± dÃ¶ndÃ¼rÃ¼r
            function getThemeClass(age) {
                if (age >= 7 && age <= 10) return 'theme-child';
                if (age >= 11 && age <= 14) return 'theme-teen';
                if (age >= 15 && age <= 18) return 'theme-young-adult';
                return 'theme-default'; // VarsayÄ±lan
            }

            // Segment yÃ¼kle (Ortak AnlatÄ±m)
            function loadSegment(segmentIndex) {
                window.speechSynthesis.cancel();
                if (segmentIndex >= quizSegments.length) {
                    showResults(); return;
                }
                currentSegmentIndex = segmentIndex;
                const segmentData = quizSegments[segmentIndex];

                // AlanlarÄ± gÃ¶ster/gizle
                playersArea.style.display = 'none'; // Oyuncu soru/cevap alanlarÄ±nÄ± gizle
                loadingIndicator.style.display = 'none';
                narrationArea.style.display = 'block';
                scoreboardElement.style.display = 'block';

                narrationInfo.textContent = `Segment ${segmentIndex + 1}: "${segmentData.narrationTitle}" konusunu dinlemek iÃ§in butona basÄ±n.`;
                playNarrationButton.disabled = false;
                playNarrationButton.textContent = "AnlatÄ±mÄ± Seslendir";

                players.forEach(player => { // Geri bildirimleri temizle
                     if(playerFeedbackElements[player.id-1]) playerFeedbackElements[player.id-1].textContent = '';
                     if(playerAreaElements[player.id-1]) playerAreaElements[player.id-1].style.borderStyle = 'solid'; // Ã‡erÃ§eveyi gÃ¶rÃ¼nÃ¼r yap ama rengi temadan alacak
                });
                updateScoreboard();
            }

            // AnlatÄ±m bitince her oyuncu iÃ§in uygun soruyu yÃ¼kle
            function handleNarrationEnd() {
                 console.log("Seslendirme bitti, sorular yÃ¼kleniyor...");
                 playNarrationButton.textContent = "AnlatÄ±m Bitti";
                 playNarrationButton.disabled = true;
                 narrationArea.style.display = 'none'; // AnlatÄ±m alanÄ±nÄ± gizle
                 loadingIndicator.style.display = 'block'; // YÃ¼kleniyor gÃ¶stergesi
                 // SorularÄ± yÃ¼klemeden Ã¶nce kÄ±sa bir gecikme (isteÄŸe baÄŸlÄ±)
                 setTimeout(() => {
                     loadQuestionsForPlayers(currentSegmentIndex);
                      loadingIndicator.style.display = 'none'; // GÃ¶stergeyi gizle
                     playersArea.style.display = 'flex'; // Oyuncu alanlarÄ±nÄ± gÃ¶ster
                 }, 500); // 0.5 saniye bekle
            }

            // Her oyuncu iÃ§in uygun soruyu bulup yÃ¼kler
            function loadQuestionsForPlayers(segmentIdx) {
                playersAnsweredCount = 0; // Bu tur iÃ§in cevap sayacÄ±nÄ± sÄ±fÄ±rla
                let currentRoundSelectedIds = []; // Bu turda seÃ§ilen soru ID'leri (aynÄ± sorunun farklÄ± oyunculara gitmesini engellemek iÃ§in)

                players.forEach(player => {
                    player.answered = false; // Cevap durumunu sÄ±fÄ±rla
                    player.currentQuestion = null; // Ã–nceki soruyu temizle
                    playerOptionsElements[player.id-1].innerHTML = ''; // ButonlarÄ± temizle
                    playerFeedbackElements[player.id-1].textContent = ''; // Geri bildirimi temizle
                    playerQuestionElements[player.id-1].textContent = 'Soru aranÄ±yor...'; // Bekleme mesajÄ±
                    playerAreaElements[player.id-1].classList.add('visible'); // GÃ¶rÃ¼nÃ¼r yap

                    // Oyuncunun yaÅŸÄ±na ve mevcut segmente uygun, daha Ã¶nce sorulmamÄ±ÅŸ ve bu turda seÃ§ilmemiÅŸ sorularÄ± filtrele
                    const suitableQuestions = questionPool.filter(q =>
                        q.segmentId === quizSegments[segmentIdx].segmentId &&
                        player.age >= q.minAge &&
                        player.age <= q.maxAge &&
                        !askedQuestionIds.includes(q.questionId) && // Genel olarak sorulmamÄ±ÅŸ
                        !currentRoundSelectedIds.includes(q.questionId) // Bu turda baÅŸkasÄ±na verilmemiÅŸ
                    );

                    let questionData = null;
                    if (suitableQuestions.length > 0) {
                        // Uygun sorulardan rastgele birini seÃ§
                        questionData = suitableQuestions[Math.floor(Math.random() * suitableQuestions.length)];
                        player.currentQuestion = questionData; // Soruyu oyuncuya ata
                        askedQuestionIds.push(questionData.questionId); // Soruyu soruldu olarak iÅŸaretle
                        currentRoundSelectedIds.push(questionData.questionId); // Bu turda seÃ§ildi olarak iÅŸaretle

                        playerQuestionElements[player.id-1].textContent = questionData.questionText;
                        const shuffledOptions = shuffleArray([...questionData.options]);
                        shuffledOptions.forEach(option => {
                            const button = document.createElement('button');
                            button.textContent = option;
                            button.onclick = () => handleAnswer(player.id, option); // Correct answer player'dan alÄ±nacak
                            playerOptionsElements[player.id-1].appendChild(button);
                        });
                    } else {
                        // Uygun soru bulunamadÄ±ysa
                        playerQuestionElements[player.id-1].textContent = 'Size uygun soru bulunamadÄ±.';
                        player.answered = true; // Otomatik cevaplamÄ±ÅŸ sayalÄ±m ki diÄŸerlerini bekletmesin
                        playersAnsweredCount++;
                    }
                });

                 // EÄŸer soru bulunamayan oyuncular yÃ¼zÃ¼nden oyun hemen biterse diye kontrol
                 if (playersAnsweredCount === players.length) {
                     console.log("TÃ¼m oyuncular iÃ§in soru bulunamadÄ± veya otomatik geÃ§ildi.");
                     setTimeout(() => loadSegment(currentSegmentIndex + 1), 1800);
                 }
            }


            // Cevap iÅŸleme (Oyuncuya Ã¶zel soruya gÃ¶re)
            function handleAnswer(playerId, selectedOption) {
                const player = players.find(p => p.id === playerId);
                // GeÃ§erli soru yoksa veya zaten cevaplamÄ±ÅŸsa Ã§Ä±k
                if (!player || player.answered || !player.currentQuestion) return;

                player.answered = true;
                playersAnsweredCount++;

                const feedbackEl = playerFeedbackElements[player.id-1];
                const sectionEl = playerAreaElements[player.id-1];
                const playerOptionButtons = playerOptionsElements[player.id-1].getElementsByTagName('button');

                // ButonlarÄ± pasif yap
                for(let btn of playerOptionButtons){ btn.disabled = true; }

                if (selectedOption === player.currentQuestion.correctAnswer) {
                    player.score++;
                    feedbackEl.textContent = "DoÄŸru!";
                    feedbackEl.className = 'player-feedback feedback-correct';
                    sectionEl.style.borderColor = 'var(--correct-border)'; // Sadece Ã§erÃ§eve rengi deÄŸiÅŸsin
                    // playSound(correctSound); // KaldÄ±rÄ±ldÄ±
                } else {
                    feedbackEl.textContent = `YanlÄ±ÅŸ!`;
                    feedbackEl.className = 'player-feedback feedback-incorrect';
                    sectionEl.style.borderColor = 'var(--incorrect-border)';
                   // playSound(incorrectSound); // KaldÄ±rÄ±ldÄ±
                }
                // Oyuncu bÃ¶lÃ¼mÃ¼ndeki skoru da gÃ¼ncelleyebiliriz ama ana yer scoreboard
                // document.getElementById(`score-player-${player.id}`).textContent = `Skor: ${player.score}`;

                updateScoreboard(); // Skor tablosunu hemen gÃ¼ncelle

                // TÃ¼m oyuncular cevap verdiyse bir sonraki segmente geÃ§
                if(playersAnsweredCount === players.length) {
                    console.log("Tur tamamlandÄ±, sonraki segmente geÃ§iliyor.");
                     loadingIndicator.style.display = 'block'; // YÃ¼kleniyor...
                     playersArea.style.display = 'none'; // Oyuncu alanlarÄ±nÄ± gizle
                     setTimeout(() => {
                         loadSegment(currentSegmentIndex + 1);
                    }, 1800);
                }
            }

            // SonuÃ§larÄ± GÃ¶ster
            function showResults() {
                 quizContent.style.display = 'none';
                 resultsElement.style.display = 'block';
                 // playSound(gameOverSound); // KaldÄ±rÄ±ldÄ±
                 finalScoresElement.innerHTML = '';
                 let maxScore = -1;
                 let winners = [];
                 const sortedPlayers = [...players].sort((a, b) => b.score - a.score);
                 sortedPlayers.forEach(player => {
                      const resultLine = document.createElement('div');
                      resultLine.classList.add('result-line');
                      // SonuÃ§larda yaÅŸÄ± da gÃ¶sterelim
                      resultLine.innerHTML = `<span class="name">${player.name} (${player.age} yaÅŸ)</span> <span class="score">${player.score} Puan</span>`;
                      finalScoresElement.appendChild(resultLine);
                      if (player.score > maxScore) { maxScore = player.score; winners = [player.name]; }
                      else if (player.score === maxScore && maxScore >= 0) { winners.push(player.name); }
                 });
                  if (maxScore <= 0 ) { winnerInfoElement.textContent = "Kimse puan alamadÄ± veya yeterli soru bulunamadÄ±!"; } // 0 puanÄ± da dahil edelim
                  else if (winners.length > 1) { winnerInfoElement.textContent = `Kazananlar (Berabere): ${winners.join(', ')} (${maxScore} puan)`; }
                  else { winnerInfoElement.textContent = `ğŸ† Kazanan: ${winners[0]} (${maxScore} puan)! ğŸ‰`; }
            }

            // Oyunu BaÅŸlatma (Ä°sim/YaÅŸ AlÄ±ndÄ±ktan Sonra)
            function initializeQuiz() {
                let allAgesValid = true;
                players.forEach((player, index) => {
                    const name = nameInputs[index].value.trim();
                    const age = parseInt(ageInputs[index].value);

                    player.name = name === '' ? `Oyuncu ${player.id}` : name;

                    if (isNaN(age) || age < 7 || age > 18) {
                        alert(`Oyuncu ${player.id} iÃ§in geÃ§erli bir yaÅŸ (7-18 arasÄ±) girin.`);
                        allAgesValid = false;
                    } else {
                        player.age = age;
                        player.themeClass = getThemeClass(age); // Tema sÄ±nÄ±fÄ±nÄ± ata
                    }
                    player.score = 0; // Skoru sÄ±fÄ±rla
                    player.answered = false;
                    player.currentQuestion = null;
                });

                if (!allAgesValid) return; // GeÃ§erli yaÅŸ girilmediyse baÅŸlatma

                // Oyuncu alanlarÄ±na tema sÄ±nÄ±flarÄ±nÄ± ve bilgileri uygula
                players.forEach(player => {
                    playerAreaElements[player.id-1].className = `player-quiz-area ${player.themeClass}`; // TemayÄ± uygula
                    nameDisplays[player.id-1].textContent = player.name;
                    ageDisplays[player.id-1].textContent = `(${player.age} yaÅŸ)`;
                    document.getElementById(`score-player-${player.id}`).textContent = `Skor: 0`; // BaÅŸlangÄ±Ã§ skoru (gerÃ§i scoreboard ana yer)
                });


                nameEntrySection.style.display = 'none';
                resultsElement.style.display = 'none';
                quizContent.style.display = 'block'; // Ana quiz iÃ§eriÄŸini gÃ¶ster
                // playSound(startGameSound); // KaldÄ±rÄ±ldÄ±
                startQuiz();
            }

            // AsÄ±l Quiz DÃ¶ngÃ¼sÃ¼nÃ¼ BaÅŸlat
            function startQuiz() {
                askedQuestionIds = []; // Sorulan sorularÄ± sÄ±fÄ±rla
                currentSegmentIndex = 0;
                updateScoreboard(); // BaÅŸlangÄ±Ã§ skor tablosu
                loadSegment(currentSegmentIndex); // Ä°lk segmenti yÃ¼kle
            }

            // Ä°sim GiriÅŸine DÃ¶n
             function resetToNameEntry() {
                 window.speechSynthesis.cancel();
                 quizContent.style.display = 'none';
                 resultsElement.style.display = 'none';
                 nameEntrySection.style.display = 'block';
                 // InputlarÄ± temizle (isteÄŸe baÄŸlÄ±)
                 nameInputs.forEach(input => input.value = '');
                 ageInputs.forEach(input => input.value = '');
                 checkTtsSupport();
             }

            // TTS DesteÄŸini Kontrol Et
             function checkTtsSupport() { /* ... Ã–nceki gibi ... */ }

            // --- Olay Dinleyicileri ---
            confirmNamesButton.addEventListener('click', initializeQuiz);
            restartButton.addEventListener('click', resetToNameEntry);
            playNarrationButton.addEventListener('click', () => {
                /* ... Ã–nceki TTS baÅŸlatma kodu ... */
                 if (!('speechSynthesis' in window) || !window.speechSynthesis) { alert("ÃœzgÃ¼nÃ¼z, tarayÄ±cÄ±nÄ±z metin seslendirme Ã¶zelliÄŸini desteklemiyor."); return; }
                 window.speechSynthesis.cancel();
                 const segmentData = quizSegments[currentSegmentIndex];
                 if (!segmentData || !segmentData.narrationText) { console.error("Seslendirilecek metin bulunamadÄ±!"); alert("Seslendirilecek metin bulunamadÄ±!"); return; }
                 const utterance = new SpeechSynthesisUtterance(segmentData.narrationText);
                 utterance.lang = 'tr-TR'; utterance.rate = 0.9; utterance.pitch = 1;
                 utterance.onend = handleNarrationEnd;
                 utterance.onerror = (event) => { console.error('TTS HatasÄ±:', event); alert(`Seslendirme hatasÄ±: ${event.error}`); playNarrationButton.textContent = "Hata!"; playNarrationButton.disabled = false; };
                 playNarrationButton.disabled = true; playNarrationButton.textContent = "Seslendiriliyor...";
                 window.speechSynthesis.speak(utterance);
            });

            // --- BaÅŸlangÄ±Ã§ ---
            resetToNameEntry(); // Sayfa ilk yÃ¼klendiÄŸinde isim giriÅŸi ekranÄ±nÄ± gÃ¶ster

        }); // DOMContentLoaded Sonu
    </script>

</body>
</html>
