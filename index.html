<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Kim Milyoner Olmak ƒ∞ster - Modern v7.1</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-grad-start: #1D2B64;
            --bg-grad-end: #3d339c;
            --container-bg: rgba(0, 0, 0, 0.4);
            --element-bg-dark: #0F172A;
            --element-bg-light: #1E293B;
            --text-light: #E2E8F0;
            --text-dark: #94A3B8;
            --accent-yellow: #FACC15;
            --accent-green: #22C55E;
            --accent-red: #EF4444;
            --accent-blue: #3B82F6;
            --font-family: 'Poppins', sans-serif;
            --transition-speed: 0.6s; /* Transition duration variable */
        }

        body {
            margin: 0; padding: 0; font-family: var(--font-family);
            background: linear-gradient(135deg, var(--bg-grad-start), var(--bg-grad-end));
            color: var(--text-light); min-height: 100vh;
            display: flex; flex-direction: column;
            overflow-x: hidden;
        }

        /* --- Transitions --- */
        #category-selection-container, #container {
            transition: opacity var(--transition-speed) ease-in-out;
        }
        .hidden-section {
            opacity: 0;
            pointer-events: none;
        }
        .visible-section {
            opacity: 1;
            pointer-events: auto;
        }

        /* --- Category Selection --- */
        #category-selection-container {
            width: 100%; text-align: center; padding: 50px 20px;
            display: flex; justify-content: center; align-items: center;
            min-height: 90vh; flex-direction: column;
            box-sizing: border-box;
        }
         #category-selection h2 { margin-bottom: 40px; font-size: 3em; font-weight: 700; color: #fff; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
         #category-selection button { margin: 10px 15px; padding: 18px 40px; font-size: 1.4em; font-weight: 600; border: none; border-radius: 12px; background: linear-gradient(145deg, var(--accent-blue), #2a6ada); color: #fff; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2); }
         #category-selection button:hover { background: linear-gradient(145deg, #2a6ada, var(--accent-blue)); transform: translateY(-3px) scale(1.03); box-shadow: 0 8px 20px rgba(43, 98, 218, 0.4); }


        /* --- Game Content Area --- */
        #container {
            display: flex; flex: 1; padding: 20px; gap: 20px;
            flex-wrap: wrap;
        }
        #game-content {
            width: 100%; display: flex; flex-wrap: inherit; gap: inherit;
        }

        /* --- Scoreboard --- */
        #scoreboard {
            width: 220px; background-color: var(--container-bg);
            border-radius: 12px; padding: 15px;
            max-height: calc(100vh - 120px); overflow-y: auto;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            margin-bottom: 20px;
            scrollbar-width: thin;
            scrollbar-color: var(--accent-yellow) transparent;
        }
         #scoreboard::-webkit-scrollbar { width: 8px; }
         #scoreboard::-webkit-scrollbar-track { background: transparent; }
         #scoreboard::-webkit-scrollbar-thumb { background-color: var(--accent-yellow); border-radius: 10px; border: 2px solid transparent; background-clip: content-box;}
         #scoreboard ul { list-style: none; padding: 0; margin: 0; }
         #scoreboard li { padding: 10px 8px; text-align: left; border-bottom: 1px solid rgba(255, 255, 255, 0.1); font-size: 1em; font-weight: 400; transition: background-color 0.3s, color 0.3s, transform 0.2s; color: var(--text-dark); display: flex; justify-content: space-between; }
         #scoreboard li span:first-child { color: var(--text-light); font-weight: 600; margin-right: 10px; min-width: 20px; display: inline-block; text-align: right; }
         #scoreboard li span:last-child { color: var(--text-light); font-weight: 600; }
         #scoreboard li.active { background-color: var(--accent-yellow); color: var(--element-bg-dark) !important; font-weight: 700; border-radius: 6px; transform: scale(1.05); }
         #scoreboard li.active span { color: var(--element-bg-dark) !important; }
         #scoreboard li.passed { opacity: 0.5; }
         #scoreboard li.baraj { font-weight: 600; color: var(--accent-yellow); border-top: 1px dashed var(--accent-yellow); margin-top: 8px; padding-top: 8px;}
         #scoreboard li.baraj span { color: var(--accent-yellow); }
         #scoreboard li.baraj.passed { color: var(--text-dark); border-top-color: var(--text-dark); opacity: 0.6;}
         #scoreboard li.baraj.passed span { color: var(--text-dark); }

        /* --- Game Area --- */
        #game-area { flex: 1; background: var(--container-bg); border-radius: 12px; padding: 25px; display: flex; flex-direction: column; box-shadow: 0 4px 10px rgba(0,0,0,0.3); min-width: 320px; }
        #quiz { text-align: center; flex: 1; display: flex; flex-direction: column; justify-content: space-between; }
        #quiz-content { flex-grow: 1; display: flex; flex-direction: column; justify-content: center; }

        /* --- Question Bar, Answers, Timer, Feedback, Reward, Lifelines --- */
         #question-bar { margin: 25px auto; background: linear-gradient(to right, var(--element-bg-dark), var(--element-bg-light)); padding: 20px 25px; border-radius: 10px; width: 95%; font-size: 1.6em; font-weight: 600; min-height: 80px; display: flex; align-items: center; justify-content: center; line-height: 1.5; box-shadow: 0 5px 12px rgba(0, 0, 0, 0.4); color: #fff; text-align: center; }
         .answers { width: 98%; margin: 20px auto 0 auto; display: flex; flex-wrap: wrap; justify-content: space-between; gap: 15px; }
         .answer { position: relative; width: calc(50% - 8px); background: linear-gradient(to right, var(--element-bg-light), var(--element-bg-dark)); border: 1px solid transparent; border-radius: 30px; margin-bottom: 0; padding: 18px 15px; cursor: pointer; display: flex; align-items: center; transition: all 0.3s ease; box-sizing: border-box; min-height: 70px; box-shadow: 0 3px 8px rgba(0, 0, 0, 0.3); }
         .answer:hover:not(.disabled) { background: linear-gradient(to right, var(--accent-blue), #2a6ada); transform: translateY(-2px) scale(1.01); box-shadow: 0 6px 15px rgba(59, 130, 246, 0.3); border-color: rgba(255, 255, 255, 0.5); }
         .answer.selected { background: linear-gradient(to right, var(--accent-yellow), #eab308) !important; color: var(--element-bg-dark); transform: scale(1.03); border-color: var(--element-bg-dark); }
         .answer.selected .answer-label, .answer.selected .answer-text { color: var(--element-bg-dark); }
         .answer.correct { background: linear-gradient(to right, var(--accent-green), #16a34a) !important; color: #fff !important; border-color: #fff; }
         .answer.correct .answer-label, .answer.correct .answer-text { color: #fff !important; }
         .answer.wrong { background: linear-gradient(to right, var(--accent-red), #dc2626) !important; color: #fff !important; animation: blink 0.7s infinite; border-color: #ff9090; }
         .answer.wrong .answer-label, .answer.wrong .answer-text { color: #fff !important; }
         @keyframes blink { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.7; transform: scale(0.98); } }
         .answer.disabled { background: linear-gradient(to right, #374151, #4B5563); cursor: not-allowed; opacity: 0.6; box-shadow: none; }
         .answer.hidden-lifeline { opacity: 0; pointer-events: none; height: 0; padding: 0; margin: 0; border: none; overflow: hidden; width: 0; transition: all 0.5s ease; visibility: hidden;}
         .answer-label { font-weight: 700; margin-right: 12px; color: var(--accent-yellow); font-size: 1.2em; }
         .answer-text { flex: 1; text-align: left; font-size: 1.1em; font-weight: 400; color: var(--text-light); }
         #timer-container { margin: 15px auto 10px auto; position: relative; width: 80px; height: 80px; }
         #timer-svg { transform: rotate(-90deg); width: 100%; height: 100%; }
         #timer-circle-bg, #timer-circle-progress { fill: none; stroke-width: 7; }
         #timer-circle-bg { stroke: rgba(255, 255, 255, 0.15); }
         #timer-circle-progress { stroke: var(--accent-yellow); stroke-linecap: round; transition: stroke-dashoffset 1s linear, stroke 0.3s ease; }
         #timer-text { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 1.6em; font-weight: 700; color: #fff; }
         #feedback { margin: 10px 0; font-size: 1.25em; min-height: 25px; color: var(--accent-yellow); font-weight: 600; }
         #reward { margin-top: 5px; margin-bottom: 15px; font-size: 1.5em; font-weight: 700;}
         .lifelines { margin: 15px 0 20px 0; display: flex; justify-content: center; gap: 25px; }
         .lifelines button { padding: 12px 20px; font-size: 0.9em; font-weight: 600; text-transform: uppercase; border: none; border-radius: 8px; background-color: var(--accent-green); color: #fff; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2); }
         .lifelines button:hover:not(:disabled) { background-color: #16a34a; transform: translateY(-2px); box-shadow: 0 6px 12px rgba(34, 197, 94, 0.3); }
         .lifelines button:disabled { background-color: #4B5563; cursor: not-allowed; opacity: 0.6; box-shadow: none; }


        /* --- Responsive Design --- */
         @media (max-width: 992px) { #container { flex-direction: column; padding: 15px; gap: 15px; } #game-content { flex-direction: column; gap: 15px; } #scoreboard { width: 100%; margin-right: 0; max-height: 250px; } #game-area { padding: 20px; } .answer { width: 100%; } #category-selection button { font-size: 1.3em; padding: 15px 35px; } }
         @media (max-width: 768px) { #category-selection button { font-size: 1.2em; padding: 15px 30px; } #question-bar { font-size: 1.3em; padding: 15px 20px; min-height: 70px;} .answer-label { font-size: 1.1em; } .answer-text { font-size: 1.05em; } .lifelines { gap: 15px; } .lifelines button { padding: 10px 15px; font-size: 0.85em;} #timer-container { width: 70px; height: 70px; } #timer-text { font-size: 1.4em; } #scoreboard li { font-size: 0.95em; padding: 8px 6px; } }
         @media (max-width: 480px) { body { font-size: 14px; } #category-selection h2 { font-size: 2em; } #category-selection button { font-size: 1.1em; padding: 12px 25px; margin: 8px; } #question-bar { font-size: 1.1em; padding: 12px 15px; } .answer { min-height: 60px; padding: 15px 12px; } .answer-label { font-size: 1em; } .answer-text { font-size: 1em; } #reward { font-size: 1.3em; } #feedback { font-size: 1.1em; } .lifelines button { font-size: 0.8em; } }

    </style>
</head>
<body>
    <div id="category-selection-container" class="visible-section"> <div id="category-selection">
            <h2>Kim Milyoner Olmak ƒ∞ster</h2>
            <button data-category="betul">Bet√ºl (8.sƒ±nƒ±f - Fen Bilimleri LGS)</button>
            <button data-category="beyza">Beyza (3.sƒ±nƒ±f)</button>
            <button data-category="rumeysa">R√ºmeysa (1.sƒ±nƒ±f)</button>
            <button data-category="oks_fen">OKS Fen (Exam Style)</button>
        </div>
    </div>

    <div id="container" class="hidden-section"> <div id="game-content">
            <div id="scoreboard">
                <ul id="scoreboard-list"></ul>
            </div>
            <div id="game-area">
                <div id="quiz">
                    <div class="lifelines">
                        <button id="lifeline-5050">50-50</button>
                        <button id="lifeline-phone">Telefon</button>
                        <button id="lifeline-audience">Seyirci</button>
                    </div>
                    <div id="timer-container">
                        <svg id="timer-svg" viewBox="0 0 36 36">
                            <circle id="timer-circle-bg" cx="18" cy="18" r="15.9155" />
                            <circle id="timer-circle-progress" cx="18" cy="18" r="15.9155" stroke-dasharray="100, 100" />
                        </svg>
                        <div id="timer-text">45</div>
                    </div>
                    <div id="quiz-content">
                        <div id="question-bar">Soru Y√ºkleniyor...</div>
                        <div class="answers">
                            <div class="answer" data-answer="A"><span class="answer-label">A:</span><span class="answer-text"></span></div>
                            <div class="answer" data-answer="B"><span class="answer-label">B:</span><span class="answer-text"></span></div>
                            <div class="answer" data-answer="C"><span class="answer-label">C:</span><span class="answer-text"></span></div>
                            <div class="answer" data-answer="D"><span class="answer-label">D:</span><span class="answer-text"></span></div>
                        </div>
                    </div>
                    <div id="feedback"></div>
                    <div id="reward">√ñd√ºl: 0 TL</div>
                   </div>
            </div>
           </div>
    </div>

    <audio id="audio-correct" src="https://assets.mixkit.co/sfx/preview/mixkit-correct-answer-tone-2870.mp3" preload="auto"></audio>
    <audio id="audio-wrong" src="https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-bass-buzzer-948.mp3" preload="auto"></audio>
    <audio id="audio-lifeline-5050" src="https://assets.mixkit.co/sfx/preview/mixkit-interface-hint-notification-911.mp3" preload="auto"></audio>
    <audio id="audio-lifeline-phone" src="https://assets.mixkit.co/sfx/preview/mixkit-modern-technology-select-3124.mp3" preload="auto"></audio>
    <audio id="audio-lifeline-audience" src="https://assets.mixkit.co/sfx/preview/mixkit-short-crowd-ovation-436.mp3" preload="auto"></audio>
    <audio id="audio-tick" src="https://assets.mixkit.co/sfx/preview/mixkit-tick-tock-clock-timer-1041.mp3" loop preload="auto"></audio>
    <audio id="audio-win" src="https://assets.mixkit.co/sfx/preview/mixkit-video-game-win-2016.mp3" preload="auto"></audio>
    <audio id="audio-background" src="https://assets.mixkit.co/music/preview/mixkit-suspense-mystery-movie-trailer-21.mp3" loop preload="auto"></audio>

    <script>
    // --- SORULAR ARTIK questions.json'DAN Y√úKLENECEK ---
    let questions = {}; // Sorular ba≈ülangƒ±√ßta bo≈ü, JSON'dan y√ºklenecek

    // --- Deƒüi≈ükenler ve DOM Elementleri ---
    let currentCategory = ""; let currentQuestionIndex = 0; let currentReward = 0;
    let currentQuestion = null; let timerInterval = null; let timeRemaining = 0;
    let gameAreaVisible = false;
    const DEFAULT_COUNTDOWN_TIME = 45; // Varsayƒ±lan s√ºre
    const OKS_FEN_COUNTDOWN_TIME = 90; // OKS Fen i√ßin √∂zel s√ºre
    const maxRewards = { // Maksimum √∂d√ºller
        "betul": 300,
        "beyza": 200,
        "rumeysa": 100,
        "oks_fen": 300
    };

    const categorySelectionContainer = document.getElementById("category-selection-container");
    const mainContainer = document.getElementById("container");
    const gameContentDiv = document.getElementById("game-content");
    const quizDiv = document.getElementById("quiz");
    const questionBar = document.getElementById("question-bar");
    const timerTextDiv = document.getElementById("timer-text");
    const timerProgressCircle = document.getElementById("timer-circle-progress");
    const feedbackDiv = document.getElementById("feedback");
    const rewardDiv = document.getElementById("reward");
    const lifeline5050Btn = document.getElementById("lifeline-5050");
    const lifelinePhoneBtn = document.getElementById("lifeline-phone");
    const lifelineAudienceBtn = document.getElementById("lifeline-audience");
    const scoreboardList = document.getElementById("scoreboard-list");
    const audioElements = { correct: document.getElementById("audio-correct"), wrong: document.getElementById("audio-wrong"), lifeline5050: document.getElementById("audio-lifeline-5050"), lifelinePhone: document.getElementById("audio-lifeline-phone"), lifelineAudience: document.getElementById("audio-lifeline-audience"), tick: document.getElementById("audio-tick"), win: document.getElementById("audio-win"), background: document.getElementById("audio-background") };
    const CIRCLE_RADIUS = 15.9155;
    const CIRCLE_CIRCUMFERENCE = 2 * Math.PI * CIRCLE_RADIUS;
    const TRANSITION_DURATION = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--transition-speed') || '0.6') * 1000;
    const SCROLL_DELAY = 800;

    // --- Ses Fonksiyonlarƒ± ---
    function playSound(audioElement) { if (!audioElement) return Promise.reject(); try { if (!audioElement.loop) audioElement.currentTime = 0; const p = audioElement.play(); return p !== undefined ? p.catch(e => {}) : Promise.resolve(); } catch (e) { return Promise.reject(e); } }
    function stopSound(audioElement) { if(audioElement){ try { audioElement.pause(); audioElement.currentTime = 0; } catch(e){} } }
    function stopAllSounds() { Object.values(audioElements).forEach(stopSound); }
    function stopBackgroundMusic() { stopSound(audioElements.background); }
    function unlockAudioContext() { Object.values(audioElements).forEach(a => { const p=a.play(); if(p) p.then(() => { a.pause(); a.currentTime=0; }).catch(e => {}); }); }

    // --- Olay Dinleyiciler ve GE√áƒ∞≈û Y√ñNETƒ∞Mƒ∞ (Fetch Eklendi) ---
    document.querySelectorAll("#category-selection button").forEach(btn => {
        btn.addEventListener("click", () => { // async eklendi
            currentCategory = btn.getAttribute("data-category");

            // === SORU Y√úKLEME ve OYUN BA≈ûLATMA ===
            async function loadAndStartGame() {
                try {
                    // Soru bankasƒ±nƒ± fetch et
                    const response = await fetch('questions.json');
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    questions = await response.json(); // Sorularƒ± global deƒüi≈ükene ata

                    // Se√ßilen kategori y√ºklendi mi ve i√ßinde soru var mƒ± kontrol et
                    if (!questions[currentCategory] || questions[currentCategory].length === 0) {
                       alert(`"${currentCategory}" kategorisi i√ßin soru bankasƒ±nda soru bulunamadƒ±.`);
                       // UI'ƒ± sƒ±fƒ±rla (√∂rneƒüin loading gizle, kategorileri g√∂ster)
                       return; // Hata varsa devam etme
                    }

                    // Sorular y√ºklendi, oyunu ba≈ülat
                    console.log("Sorular ba≈üarƒ±yla y√ºklendi. Kategori:", currentCategory);
                    stopAllSounds();
                    unlockAudioContext();

                    // Ekran ge√ßi≈üi ve oyun ba≈ülatma mantƒ±ƒüƒ±
                    categorySelectionContainer.classList.remove('visible-section');
                    categorySelectionContainer.classList.add('hidden-section');

                    setTimeout(() => {
                        categorySelectionContainer.style.display = 'none';
                        mainContainer.classList.remove('hidden-section');
                        mainContainer.classList.add('visible-section');
                        mainContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });

                        setTimeout(() => {
                             if (mainContainer.classList.contains('visible-section')) {
                                gameAreaVisible = true;
                                resetLifelines();
                                currentQuestionIndex = 0;
                                currentReward = 0;
                                updateRewardDisplay();
                                generateScoreboard(); // Artƒ±k questions dolu
                                loadQuestion();     // Artƒ±k questions dolu
                                setTimeout(() => { if (gameAreaVisible) { playSound(audioElements.background).catch(e => {}); } }, 150);
                            }
                        }, SCROLL_DELAY);
                    }, TRANSITION_DURATION);

                } catch (error) {
                    console.error('Soru bankasƒ± y√ºklenirken hata olu≈ütu:', error);
                    alert('Soru bankasƒ± y√ºklenemedi. L√ºtfen sayfayƒ± yenileyip tekrar deneyin veya internet baƒülantƒ±nƒ±zƒ± kontrol edin.');
                    // Hata durumunda UI'ƒ± uygun bir duruma getir
                    // √ñrneƒüin, tekrar kategori se√ßimine d√∂n
                    // mainContainer.classList.add('hidden-section');
                    // categorySelectionContainer.style.display = 'flex';
                    // categorySelectionContainer.classList.add('visible-section');
                }
            }

            loadAndStartGame(); // Fetch ve ba≈ülatma i≈ülemini tetikle
            // === SORU Y√úKLEME ve OYUN BA≈ûLATMA SONU ===
        });
    });

    // --- Diƒüer Fonksiyonlar ---
    function resetLifelines() { lifeline5050Used = false; lifelinePhoneUsed = false; lifelineAudienceUsed = false; [lifeline5050Btn, lifelinePhoneBtn, lifelineAudienceBtn].forEach(btn => { btn.disabled = false; btn.style.opacity = 1; }); }

    function generateScoreboard() {
         scoreboardList.innerHTML = "";
         const maxReward = maxRewards[currentCategory] || 100;
         const categoryQuestions = questions[currentCategory] || []; // Y√ºklenen sorularƒ± kullan
         const actualQuestionCount = categoryQuestions.length;
         const { baraj1, baraj2 } = getBarajLevels(currentCategory);
         if(actualQuestionCount === 0) return;
         for (let level = actualQuestionCount; level >= 1; level--) {
             const rewardVal = Math.round(maxReward * (level / actualQuestionCount));
             const li = document.createElement("li"); li.setAttribute("data-step", level);
             const numberSpan = `<span>${level}.</span>`; const amountSpan = `<span>${rewardVal.toLocaleString('tr-TR')} TL</span>`;
             li.innerHTML = `${numberSpan}${amountSpan}`;
             if (level === baraj1 || level === baraj2) { li.classList.add('baraj'); }
             if (level === actualQuestionCount) { li.style.color = 'var(--accent-yellow)'; li.style.fontWeight = '700'; }
             scoreboardList.appendChild(li);
         }
         updateScoreboardVisuals();
     }

     function getBarajLevels(category) {
        if (category === 'oks_fen') { return { baraj1: 4, baraj2: 7 }; }
        else { return { baraj1: 5, baraj2: 10 }; }
     }

    function updateScoreboardVisuals() {
        const { baraj1, baraj2 } = getBarajLevels(currentCategory);
        const categoryQuestions = questions[currentCategory] || [];
        const actualQuestionCount = categoryQuestions.length;
        document.querySelectorAll("#scoreboard li").forEach(li => {
             const level = parseInt(li.getAttribute("data-step"));
             li.classList.remove("active", "passed", "baraj"); li.style.transform = ''; li.style.opacity = 1; li.style.color = ''; li.style.fontWeight = '400';
             if (level === baraj1 || level === baraj2) { li.classList.add('baraj'); }
             if (level === (currentQuestionIndex + 1) && level <= actualQuestionCount ) { li.classList.add("active"); li.style.transform = 'scale(1.05)'; }
             else if (level <= currentQuestionIndex) { li.classList.add("passed"); if (li.classList.contains('baraj')) { li.style.color = 'var(--text-dark)'; li.style.opacity = 0.7; } else { li.style.opacity = 0.5; } }
             else { if (li.classList.contains('baraj')) { li.style.color = 'var(--accent-yellow)'; li.style.fontWeight = '600'; } else if (level === actualQuestionCount) { li.style.color = 'var(--accent-yellow)'; li.style.fontWeight = '700'; } }
              const spans = li.querySelectorAll('span'); spans.forEach(span => span.style.color = '');
              if(li.classList.contains('active')){ spans.forEach(span => span.style.color = 'var(--element-bg-dark)'); }
              else if (li.classList.contains('baraj') && !li.classList.contains('passed')) { spans.forEach(span => span.style.color = 'var(--accent-yellow)'); }
              else if (li.classList.contains('baraj') && li.classList.contains('passed')) { spans.forEach(span => span.style.color = 'var(--text-dark)'); }
              else if (level === actualQuestionCount && !li.classList.contains('passed') && !li.classList.contains('active')) { spans.forEach(span => span.style.color = 'var(--accent-yellow)'); }
              else if (li.classList.contains('passed')){} else { spans[0].style.color = 'var(--text-light)'; spans[1].style.color = 'var(--text-light)'; }
         });
         updateScoreboardScroll();
     }

    function updateScoreboardScroll() { const activeLi = scoreboardList.querySelector('li.active'); if (activeLi) { activeLi.scrollIntoView({ behavior: 'smooth', block: 'nearest' }); } else { const lastPassed = scoreboardList.querySelector('li.passed:last-of-type'); if(lastPassed) { lastPassed.scrollIntoView({ behavior: 'smooth', block: 'nearest' }); } else { const firstLi = scoreboardList.querySelector('li'); if (firstLi) { firstLi.scrollIntoView({ behavior: 'smooth', block: 'start' }); } } } }

    // loadQuestion FONKSƒ∞YONU G√úNCELLENDƒ∞ (options yerine optionA, optionB... kullanƒ±yor)
    function loadQuestion() {
        if (!gameAreaVisible) return;
        clearTimer(); feedbackDiv.textContent = ""; enableAllAnswers();
        const categoryQuestions = questions[currentCategory] || []; // Y√ºklenen sorularƒ± kullan
        const actualQuestionCount = categoryQuestions.length;
        if (currentQuestionIndex >= actualQuestionCount) {
            const finalReward = maxRewards[currentCategory] || 100;
            feedbackDiv.innerHTML = `üèÜ TEBRƒ∞KLER! KATEGORƒ∞Yƒ∞ TAMAMLADINIZ! √ñd√ºl: ${finalReward.toLocaleString('tr-TR')} TL üèÜ`;
            playSound(audioElements.win); stopBackgroundMusic(); disableAllAnswers(); updateScoreboardVisuals(); gameAreaVisible = false; return;
        }
        updateScoreboardVisuals();
        currentQuestion = categoryQuestions[currentQuestionIndex];
        questionBar.innerHTML = `${currentQuestionIndex + 1}. ${currentQuestion.question}`;

        const answerDivs = document.querySelectorAll(".answer");
        answerDivs.forEach(div => {
            div.classList.remove("correct", "wrong", "selected", "hidden-lifeline");
            div.style.display = 'flex'; div.style.opacity = 1; div.style.height = ''; div.style.padding = ''; div.style.margin = ''; div.style.border = ''; div.style.pointerEvents = ''; div.style.animation = ''; div.style.visibility = 'visible';
            if (window.innerWidth <= 992) { div.style.width = '100%'; } else { div.style.width = 'calc(50% - 8px)'; }

            const ansKey = div.getAttribute("data-answer"); // A, B, C, D
            const ansTextSpan = div.querySelector(".answer-text");

            // === DEƒûƒ∞≈ûEN KISIM (Yeni JSON formatƒ±na g√∂re) ===
            let optionText = "";
            if (ansKey === 'A') { optionText = currentQuestion.optionA; }
            else if (ansKey === 'B') { optionText = currentQuestion.optionB; }
            else if (ansKey === 'C') { optionText = currentQuestion.optionC; }
            else if (ansKey === 'D') { optionText = currentQuestion.optionD; }
            // === DEƒûƒ∞≈ûEN KISIM SONU ===

            if (optionText !== undefined && ansTextSpan) {
                ansTextSpan.textContent = optionText;
            } else {
                div.style.display = 'none'; // Bu se√ßenek i√ßin metin yoksa gizle
            }
        });
        const timeLimit = (currentCategory === 'oks_fen') ? OKS_FEN_COUNTDOWN_TIME : DEFAULT_COUNTDOWN_TIME;
        startTimer(timeLimit);
    }


    document.querySelectorAll(".answer").forEach(answerEl => { answerEl.addEventListener("click", () => { if (answerEl.classList.contains("disabled") || answerEl.classList.contains("hidden-lifeline") || !gameAreaVisible || answerEl.style.visibility === 'hidden') return; clearTimer(); const selectedAnswer = answerEl.getAttribute("data-answer"); disableAllAnswers(); answerEl.classList.add("selected"); setTimeout(() => { if(!gameAreaVisible) return; answerEl.classList.remove("selected"); if (selectedAnswer === currentQuestion.answer) { handleCorrectAnswer(answerEl); } else { handleWrongAnswer(answerEl); } }, 2000); }); });

     function handleCorrectAnswer(correctAnswerElement) {
        if (!gameAreaVisible) return;
         correctAnswerElement.classList.add("correct"); feedbackDiv.innerHTML = "Doƒüru Cevap! ‚úÖ"; playSound(audioElements.correct);
         const maxRewardCurrentCategory = maxRewards[currentCategory] || 100;
         const categoryQuestions = questions[currentCategory] || []; const actualQuestionCount = categoryQuestions.length;
         currentReward = Math.round(maxRewardCurrentCategory * ((currentQuestionIndex + 1) / actualQuestionCount));
         updateRewardDisplay(); currentQuestionIndex++; setTimeout(loadQuestion, 2500);
     }
     function handleWrongAnswer(wrongAnswerElement) {
         if (!gameAreaVisible) return; wrongAnswerElement.classList.add("wrong"); const guaranteedReward = calculateGuaranteedReward(); const correctAnswerDiv = document.querySelector(`.answer[data-answer="${currentQuestion.answer}"]`); feedbackDiv.innerHTML = `Yanlƒ±≈ü Cevap! ‚ùå Doƒüru: ${currentQuestion.answer}.<br>Kazandƒ±ƒüƒ±nƒ±z √∂d√ºl: ${guaranteedReward.toLocaleString('tr-TR')} TL`; playSound(audioElements.wrong); stopBackgroundMusic(); if (correctAnswerDiv) { correctAnswerDiv.classList.add("correct"); } disableAllAnswers(); gameAreaVisible = false; currentReward = guaranteedReward; updateRewardDisplay(); updateScoreboardVisuals();
      }

     function calculateGuaranteedReward() {
        const maxRewardCurrentCategory = maxRewards[currentCategory] || 100;
        const categoryQuestions = questions[currentCategory] || []; const actualQuestionCount = categoryQuestions.length;
        const { baraj1, baraj2 } = getBarajLevels(currentCategory);
        if(actualQuestionCount === 0) return 0; let guaranteedReward = 0;
        if (currentQuestionIndex >= baraj2) { guaranteedReward = Math.round(maxRewardCurrentCategory * (baraj2 / actualQuestionCount)); }
        else if (currentQuestionIndex >= baraj1) { guaranteedReward = Math.round(maxRewardCurrentCategory * (baraj1 / actualQuestionCount)); }
        return guaranteedReward;
    }
    function disableAllAnswers() { document.querySelectorAll(".answer").forEach(div => { if (div.style.display !== 'none' && !div.classList.contains('hidden-lifeline') && div.style.visibility !== 'hidden') { div.classList.add("disabled"); div.style.cursor = 'default'; } div.style.animation = ''; div.classList.remove("selected"); }); }
    function enableAllAnswers() { document.querySelectorAll(".answer").forEach(div => { if (!div.classList.contains('hidden-lifeline')) { div.classList.remove("disabled", "correct", "wrong", "selected"); div.style.background = ''; div.style.visibility = 'visible'; div.style.cursor = 'pointer'; div.style.opacity = 1; } else { div.classList.add("disabled"); div.style.cursor = 'default'; div.style.visibility = 'hidden'; } }); }

     function setProgress(percent, currentTime) { const offset = CIRCLE_CIRCUMFERENCE - (percent / 100) * CIRCLE_CIRCUMFERENCE; timerProgressCircle.style.strokeDashoffset = offset; timerTextDiv.textContent = currentTime; }

     function startTimer(timeLimit) {
          clearTimer(); timeRemaining = timeLimit; timerProgressCircle.style.strokeDasharray = `${CIRCLE_CIRCUMFERENCE} ${CIRCLE_CIRCUMFERENCE}`; timerProgressCircle.style.strokeDashoffset = CIRCLE_CIRCUMFERENCE; timerTextDiv.textContent = timeRemaining;
          setTimeout(() => {
            if (!gameAreaVisible) return;
            setProgress(100 * timeRemaining / timeLimit, timeRemaining); playSound(audioElements.tick).catch(e => {});
             timerInterval = setInterval(() => {
                 if (!gameAreaVisible) { clearTimer(); return; }
                 timeRemaining--; const percent = Math.max(0, 100 * timeRemaining / timeLimit); setProgress(percent, timeRemaining);
                 if (timeRemaining <= 0) { handleTimeUp(); }
                 const redThreshold = Math.max(5, Math.floor(timeLimit * 0.2));
                 timerProgressCircle.style.stroke = (timeRemaining <= redThreshold) ? 'var(--accent-red)' : 'var(--accent-yellow)';
            }, 1000);
          }, 50);
      }

     function clearTimer() { if (timerInterval) { clearInterval(timerInterval); timerInterval = null; stopSound(audioElements.tick); } timerTextDiv.textContent = "-"; timerProgressCircle.style.stroke = 'var(--accent-yellow)'; timerProgressCircle.style.transition = 'none'; timerProgressCircle.style.strokeDashoffset = CIRCLE_CIRCUMFERENCE; setTimeout(() => { timerProgressCircle.style.transition = 'stroke-dashoffset 1s linear, stroke 0.3s ease'; }, 50); }
     function handleTimeUp() { if (!gameAreaVisible) return; clearTimer(); const guaranteedReward = calculateGuaranteedReward(); feedbackDiv.innerHTML = `‚è∞ S√ºre Doldu! Oyun bitti.<br>Kazandƒ±ƒüƒ±nƒ±z √∂d√ºl: ${guaranteedReward.toLocaleString('tr-TR')} TL`; playSound(audioElements.wrong); stopBackgroundMusic(); disableAllAnswers(); const correctAnswerDiv = document.querySelector(`.answer[data-answer="${currentQuestion.answer}"]`); if (correctAnswerDiv) { correctAnswerDiv.classList.add("correct"); } gameAreaVisible = false; currentReward = guaranteedReward; updateRewardDisplay(); updateScoreboardVisuals(); }

     // Joker Fonksiyonlarƒ± (Deƒüi≈üiklik yok)
      let lifeline5050Used = false, lifelinePhoneUsed = false, lifelineAudienceUsed = false;
      lifeline5050Btn.addEventListener("click", () => { if (lifeline5050Used || !currentQuestion || !gameAreaVisible || timerInterval === null) return; lifeline5050Used = true; lifeline5050Btn.disabled = true; lifeline5050Btn.style.opacity = 0.6; playSound(audioElements.lifeline5050); const wrongAnswers = []; document.querySelectorAll(".answer").forEach(div => { if (div.style.display !== 'none' && div.style.visibility !== 'hidden' && !div.classList.contains('hidden-lifeline') && div.getAttribute("data-answer") !== currentQuestion.answer) { wrongAnswers.push(div); } }); let count = 0; wrongAnswers.sort(() => Math.random() - 0.5); while (count < 2 && wrongAnswers.length > 0) { const answerToRemove = wrongAnswers.pop(); if (answerToRemove) { answerToRemove.classList.add('hidden-lifeline', 'disabled'); answerToRemove.style.visibility = 'hidden'; answerToRemove.style.cursor = 'default'; count++; } } feedbackDiv.textContent = "50-50 Jokeri kullanƒ±ldƒ±. ƒ∞ki ≈üƒ±k elendi."; });
      lifelinePhoneBtn.addEventListener("click", () => { if (lifelinePhoneUsed || !currentQuestion || !gameAreaVisible || timerInterval === null) return; lifelinePhoneUsed = true; lifelinePhoneBtn.disabled = true; lifelinePhoneBtn.style.opacity = 0.6; playSound(audioElements.lifelinePhone); let phoneGuess = ""; const randomChance = Math.random(); const correctAnswerKey = currentQuestion.answer; const visibleOptions = []; document.querySelectorAll(".answer").forEach(div => { if (div.style.display !== 'none' && !div.classList.contains('hidden-lifeline') && div.style.visibility !== 'hidden') { visibleOptions.push(div.getAttribute("data-answer")); } }); if (visibleOptions.length === 0) return; if (randomChance < 0.75 && visibleOptions.includes(correctAnswerKey)) { phoneGuess = correctAnswerKey; } else { const wrongVisibleOptions = visibleOptions.filter(opt => opt !== correctAnswerKey); if(wrongVisibleOptions.length > 0) { phoneGuess = wrongVisibleOptions[Math.floor(Math.random() * wrongVisibleOptions.length)]; } else { phoneGuess = correctAnswerKey; } } feedbackDiv.textContent = `üìû Telefonla Yardƒ±m: "Bence cevap ${phoneGuess} ≈üƒ±kkƒ± olabilir..."`; });
      lifelineAudienceBtn.addEventListener("click", () => { if (lifelineAudienceUsed || !currentQuestion || !gameAreaVisible || timerInterval === null) return; lifelineAudienceUsed = true; lifelineAudienceBtn.disabled = true; lifelineAudienceBtn.style.opacity = 0.6; playSound(audioElements.lifelineAudience); const answers = ["A", "B", "C", "D"]; let percentages = {}; let remainingPercent = 100; const visibleOptions = []; document.querySelectorAll(".answer").forEach(div => { const ansKey = div.getAttribute("data-answer"); if (div.style.display !== 'none' && !div.classList.contains('hidden-lifeline') && div.style.visibility !== 'hidden') { visibleOptions.push(ansKey); } else { percentages[ansKey] = 0; } }); if (visibleOptions.length === 0) return; const correctAnswerKey = currentQuestion.answer; let correctPercent = 0; if (visibleOptions.includes(correctAnswerKey)) { let baseCorrect = (visibleOptions.length === 2) ? 60 : 40; let randomCorrect = (visibleOptions.length === 2) ? 25 : 31; correctPercent = Math.floor(Math.random() * randomCorrect) + baseCorrect; correctPercent = Math.min(correctPercent, 90); percentages[correctAnswerKey] = correctPercent; remainingPercent -= correctPercent; } const otherVisibleOptions = visibleOptions.filter(opt => opt !== correctAnswerKey); let allocatedPercent = 0; for (let i = 0; i < otherVisibleOptions.length; i++) { const opt = otherVisibleOptions[i]; if (i === otherVisibleOptions.length - 1) { percentages[opt] = Math.max(0, remainingPercent - allocatedPercent); } else { let avgRemaining = (remainingPercent - allocatedPercent) / (otherVisibleOptions.length - i); let perc = Math.floor(Math.random() * Math.min((remainingPercent - allocatedPercent) + 1, avgRemaining * 1.5)); perc = Math.min(perc, remainingPercent - allocatedPercent); percentages[opt] = Math.max(0, perc); allocatedPercent += percentages[opt]; } } let currentTotal = 0; visibleOptions.forEach(opt => currentTotal += (percentages[opt] || 0)); let diff = 100 - currentTotal; if (diff !== 0 && visibleOptions.length > 0) { let adjustKey = correctAnswerKey; if (!visibleOptions.includes(correctAnswerKey) || (otherVisibleOptions.length > 0 && percentages[otherVisibleOptions[0]] > percentages[correctAnswerKey])) { let maxPerc = -1; visibleOptions.forEach(opt => { if(percentages[opt] > maxPerc) { maxPerc = percentages[opt]; adjustKey = opt; } }); } if(percentages[adjustKey] !== undefined){ percentages[adjustKey] = Math.max(0, percentages[adjustKey] + diff); } else if(visibleOptions.length > 0) { percentages[visibleOptions[0]] = Math.max(0, (percentages[visibleOptions[0]] || 0) + diff); } } let resultText = "üìä Seyirci Oylarƒ±: "; answers.forEach(ans => { if (visibleOptions.includes(ans)) { resultText += ` ${ans}: %${Math.round(percentages[ans] || 0)} `; } }); feedbackDiv.textContent = resultText.trim(); });

    function updateRewardDisplay() { rewardDiv.textContent = "√ñd√ºl: " + currentReward.toLocaleString('tr-TR', { style: 'currency', currency: 'TRY', minimumFractionDigits: 0, maximumFractionDigits: 0 }); }

    // Initial Setup
    timerProgressCircle.style.strokeDasharray = `${CIRCLE_CIRCUMFERENCE} ${CIRCLE_CIRCUMFERENCE}`; timerProgressCircle.style.strokeDashoffset = CIRCLE_CIRCUMFERENCE;
    categorySelectionContainer.classList.add('visible-section'); categorySelectionContainer.classList.remove('hidden-section');
    mainContainer.classList.add('hidden-section'); mainContainer.classList.remove('visible-section');

    </script>
</body>
</html>